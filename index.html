<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WEARENFEEL</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Montserrat:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           HIGH-LUXURY FASHION EDITORIAL DESIGN
           Inspired by Vogue, Harper's Bazaar, Saint Laurent
           ======================================== */
        
        :root {
            --color-bg: #0a0908;
            --color-surface: #121110;
            --color-surface-elevated: #1a1918;
            --color-text: #faf9f7;
            --color-text-secondary: #a8a5a0;
            --color-text-muted: #6b6965;
            --color-accent: #c9a962;
            --color-accent-hover: #d4b875;
            --color-danger: #8b2635;
            --color-success: #4a7c59;
            --color-border: rgba(255,255,255,0.08);
            --color-border-hover: rgba(255,255,255,0.15);
            --font-display: 'Cormorant Garamond', serif;
            --font-body: 'Montserrat', sans-serif;
            --transition-elegant: cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * { 
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-text);
            overflow-x: hidden;
            min-height: 100vh;
            font-weight: 300;
            letter-spacing: 0.02em;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-display);
            font-weight: 400;
            letter-spacing: 0.01em;
        }
        
        .accent { color: var(--color-accent); }
        .bg-accent { background: var(--color-accent); }
        .text-muted { color: var(--color-text-muted); }
        
        /* Product Grid - Editorial Masonry Layout */
        .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
            padding: 0;
        }
        
        .product-card {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.6s var(--transition-elegant);
        }
        
        .product-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(10,9,8,0.7) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.5s var(--transition-elegant);
        }
        
        .product-card:hover::after,
        .product-card:active::after {
            opacity: 1;
        }
        
        .product-card img {
            transition: transform 0.8s var(--transition-elegant), filter 0.5s ease;
            filter: saturate(0.9) contrast(1.05);
        }
        
        .product-card:hover img {
            transform: scale(1.03);
            filter: saturate(1) contrast(1.1);
        }
        
        .product-card:active {
            transform: scale(0.995);
        }
        
        /* Elegant staggered masonry effect */
        .product-card:nth-child(odd) { margin-top: 0; }
        .product-card:nth-child(even) { margin-top: 40px; }
        .product-card:nth-child(3n) { margin-top: -25px; }
        .product-card:nth-child(4n) { margin-top: 55px; }
        .product-card:nth-child(5n) { margin-top: 20px; }
        
        .price-tag {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 16px;
            background: linear-gradient(to top, rgba(10,9,8,0.95) 0%, rgba(10,9,8,0.6) 60%, transparent 100%);
            font-family: var(--font-display);
            font-weight: 500;
            font-size: 1.15rem;
            letter-spacing: 0.05em;
            z-index: 2;
        }
        
        .sold-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-12deg);
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            font-style: italic;
            color: var(--color-text);
            border: 1px solid var(--color-text);
            padding: 0.6rem 1.8rem;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            background: rgba(10,9,8,0.85);
            backdrop-filter: blur(4px);
            z-index: 3;
        }
        
        /* Image Slider for Product Page */
        .image-slider {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .image-slider::-webkit-scrollbar { display: none; }
        
        .image-slide {
            flex: 0 0 100%;
            scroll-snap-align: start;
        }
        
        /* ========================================
           LUXURY FORMS & BUTTONS
           ======================================== */
        input, select, textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--color-border);
            color: var(--color-text);
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 300;
            padding: 1.1rem 0;
            width: 100%;
            outline: none;
            transition: border-color 0.4s var(--transition-elegant), background 0.3s ease;
            border-radius: 0;
            -webkit-appearance: none;
            letter-spacing: 0.03em;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--color-accent);
            background: rgba(201, 169, 98, 0.03);
        }
        
        input::placeholder, textarea::placeholder { 
            color: var(--color-text-muted);
            font-style: italic;
            font-weight: 300;
        }
        
        input.error {
            border-color: var(--color-danger);
            animation: shake 0.4s var(--transition-elegant);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }
        
        .field-error {
            color: var(--color-danger);
            font-size: 0.7rem;
            font-weight: 400;
            margin-top: 6px;
            letter-spacing: 0.05em;
            animation: fadeIn 0.3s ease;
        }

        /* Elegant checkbox */
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            min-width: 18px;
            appearance: none;
            -webkit-appearance: none;
            border: 1px solid var(--color-border-hover);
            border-radius: 2px;
            background: transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s var(--transition-elegant);
            margin-top: 3px;
        }
        
        input[type="checkbox"]:checked {
            background: var(--color-accent);
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(201, 169, 98, 0.15);
        }
        
        input[type="checkbox"]:checked::after {
            content: '‚úì';
            font-size: 11px;
            color: var(--color-bg);
            font-weight: 600;
        }

        input[type="checkbox"].error {
            border-color: var(--color-danger);
            box-shadow: 0 0 0 2px rgba(139, 38, 53, 0.3);
        }
        
        /* Primary Button - Luxe Gold */
        .btn-primary {
            background: var(--color-accent);
            color: var(--color-bg);
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 0.8rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            padding: 1.3rem 2.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.4s var(--transition-elegant);
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            background: var(--color-accent-hover);
            box-shadow: 0 8px 30px rgba(201, 169, 98, 0.25);
        }
        
        .btn-primary:disabled {
            background: var(--color-surface);
            color: var(--color-text-muted);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .btn-primary:not(:disabled):active { 
            transform: scale(0.98);
        }
        
        /* Secondary Button - Minimal Elegance */
        .btn-secondary {
            background: transparent;
            border: 1px solid var(--color-border-hover);
            color: var(--color-text);
            font-family: var(--font-body);
            font-weight: 400;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 1rem 1.8rem;
            cursor: pointer;
            transition: all 0.4s var(--transition-elegant);
            position: relative;
        }
        
        .btn-secondary::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 1px;
            background: var(--color-accent);
            transition: all 0.4s var(--transition-elegant);
            transform: translateX(-50%);
        }
        
        .btn-secondary:hover {
            border-color: var(--color-text-secondary);
            color: var(--color-accent);
        }
        
        .btn-secondary:hover::after {
            width: 80%;
        }
        
        /* Size selector - Refined */
        .size-btn {
            font-family: var(--font-body);
            font-weight: 300;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            transition: all 0.3s var(--transition-elegant);
            min-width: 48px;
            text-align: center;
            border-color: var(--color-border);
        }
        
        .size-btn:hover {
            border-color: var(--color-text-secondary);
        }
        
        .size-btn.selected {
            border-color: var(--color-accent);
            background: rgba(201, 169, 98, 0.1);
            color: var(--color-accent);
        }
        
        /* ========================================
           BIDDING UI - Refined & Luxe
           ======================================== */
        .bid-code-display {
            font-family: var(--font-display);
            font-size: 2.8rem;
            letter-spacing: 0.35em;
            color: var(--color-accent);
            font-weight: 500;
            font-style: italic;
        }
        
        .bid-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 2px;
            font-family: var(--font-body);
            font-size: 0.65rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }
        
        .bid-status.active {
            background: rgba(74, 124, 89, 0.12);
            color: var(--color-success);
            border: 1px solid rgba(74, 124, 89, 0.25);
        }
        
        .bid-status.closed {
            background: rgba(168, 165, 160, 0.08);
            color: var(--color-text-secondary);
            border: 1px solid rgba(168, 165, 160, 0.2);
        }
        
        .bid-status.won {
            background: rgba(74, 124, 89, 0.15);
            color: var(--color-success);
            border: 1px solid rgba(74, 124, 89, 0.3);
        }
        
        .bid-status.lost {
            background: rgba(139, 38, 53, 0.1);
            color: var(--color-danger);
            border: 1px solid rgba(139, 38, 53, 0.25);
        }
        
        /* ========================================
           NAVIGATION & MENU - Editorial Style
           ======================================== */
        .header-blur {
            background: rgba(10,9,8,0.85);
            backdrop-filter: blur(25px) saturate(1.2);
            -webkit-backdrop-filter: blur(25px) saturate(1.2);
            border-bottom: 1px solid var(--color-border);
        }
        
        .menu-overlay {
            position: fixed;
            inset: 0;
            background: var(--color-bg);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s var(--transition-elegant), visibility 0.5s var(--transition-elegant);
        }
        
        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .menu-link {
            font-family: var(--font-display);
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.02em;
            transition: all 0.4s var(--transition-elegant);
            position: relative;
        }
        
        .menu-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--color-accent);
            transition: width 0.4s var(--transition-elegant);
        }
        
        .menu-link:hover, .menu-link:active {
            color: var(--color-accent);
        }
        
        .menu-link:hover::after {
            width: 100%;
        }
        
        /* Secret admin trigger */
        #secretAdminBtn { 
            cursor: default; 
            padding: 15px 0; 
            opacity: 0.2; 
            transition: opacity 0.4s var(--transition-elegant); 
        }
        
        #secretAdminBtn:active { opacity: 0.4; }
        
        /* ========================================
           ADMIN PANEL - Clean & Professional
           ======================================== */
        .admin-tab {
            cursor: pointer;
            font-family: var(--font-body);
            font-weight: 400;
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            transition: all 0.4s var(--transition-elegant);
            white-space: nowrap;
        }
        
        .admin-tab:hover {
            color: var(--color-text) !important;
        }
        
        .admin-card {
            background: var(--color-surface);
            padding: 24px;
            border: 1px solid var(--color-border);
            transition: all 0.4s var(--transition-elegant);
        }
        
        .admin-card:hover {
            background: var(--color-surface-elevated);
            border-color: var(--color-border-hover);
        }
        
        .admin-select {
            background: var(--color-surface) !important;
            color: var(--color-text) !important;
            border: 1px solid var(--color-border) !important;
            padding: 12px !important;
            width: 100%;
            font-family: var(--font-body);
        }
        
        select option {
            background: var(--color-surface);
            color: var(--color-text);
        }

        /* Admin layout polish */
        #adminProductList > div,
        #adminOrderList > div,
        #adminCustomerList > div,
        #adminBidsList > div,
        #adminAppliedList > div {
            border-radius: 4px;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            transition: all 0.3s var(--transition-elegant);
        }
        
        #adminProductList > div:hover,
        #adminOrderList > div:hover,
        #adminCustomerList > div:hover {
            border-color: var(--color-border-hover);
        }

        #adminOrderList > div,
        #adminProductList > div { padding: 20px; }

        .admin-content { padding-bottom: 32px; }

        .admin-content h2,
        .admin-content h3,
        .admin-content h4 { 
            font-family: var(--font-display);
            letter-spacing: 0.02em; 
        }

        .admin-action-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .admin-action-bar .btn-secondary,
        .admin-action-bar .btn-primary { width: auto; }
        
        /* ========================================
           PHASE 10: PRINT STYLES
           ======================================== */
        .checkbox-custom {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border: 2px solid #444;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .checkbox-custom.checked {
            background: #c41e3a;
            border-color: #c41e3a;
        }
        
        @media print {
            body * { visibility: hidden; }
            #printContainer, #printContainer * { visibility: visible; }
            #printContainer { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                background: #fff; 
            }
            body { 
                background: #fff !important; 
                color: #000 !important; 
            }
            .print-labels-container { 
                display: flex; 
                flex-direction: column; 
                gap: 8mm; 
                padding: 10mm; 
            }
            .print-label { 
                width: 100%; 
                border: 1px solid #000; 
                padding: 8mm; 
                page-break-inside: avoid; 
                background: #fff; 
            }
            .print-label h3 { 
                font-size: 14pt; 
                font-weight: bold; 
                margin: 0 0 3mm 0; 
                border-bottom: 1px solid #ccc; 
                padding-bottom: 2mm; 
            }
            .print-label .recipient-name { 
                font-size: 12pt; 
                font-weight: bold; 
                margin: 3mm 0 2mm 0; 
            }
            .print-label .address-text { 
                font-size: 10pt; 
                line-height: 1.5; 
            }
            .print-label .phone { 
                font-size: 11pt; 
                font-weight: bold; 
                margin: 3mm 0; 
            }
            .print-label .product-info { 
                font-size: 9pt; 
                color: #666; 
                margin-top: 3mm; 
                border-top: 1px dashed #ccc; 
                padding-top: 2mm; 
            }
        }
        
        /* ========================================
           ANIMATIONS & UTILITIES - Elegant Motion
           ======================================== */
        .tracking-brutal { letter-spacing: -0.02em; }
        
        .fade-in {
            animation: fadeIn 1s var(--transition-elegant) forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.8s var(--transition-elegant) forwards;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page { 
            display: none;
            min-height: 100vh;
        }
        
        .page.active { 
            display: block;
            animation: pageReveal 0.6s var(--transition-elegant);
        }
        
        @keyframes pageReveal {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 16px;
            z-index: 60;
            padding: 0;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(10,9,8,0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--color-border);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s var(--transition-elegant);
        }
        
        .back-btn:hover {
            background: rgba(10,9,8,0.9);
            border-color: var(--color-border-hover);
        }
        
        .back-btn svg {
            width: 18px;
            height: 18px;
            stroke: var(--color-text);
            stroke-width: 1.5;
        }
        
        .fullscreen-gallery {
            position: fixed;
            inset: 0;
            background: var(--color-bg);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s var(--transition-elegant);
        }
        
        .fullscreen-gallery.active { 
            opacity: 1;
            visibility: visible;
        }
        
        .dot-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-text-muted);
            transition: all 0.4s var(--transition-elegant);
        }
        
        .dot-indicator.active {
            background: var(--color-accent);
            transform: scale(1.2);
            box-shadow: 0 0 12px rgba(201, 169, 98, 0.5);
        }
        
        .otp-modal {
            position: fixed;
            inset: 0;
            background: rgba(10,9,8,0.98);
            z-index: 80;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s var(--transition-elegant);
        }
        
        .otp-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .locked-field {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255,255,255,0.02) !important;
            padding-left: 12px;
            color: var(--color-text-muted) !important;
            font-style: italic;
        }
        
        .no-print { }
        
        /* Custom Scrollbar for elegance */
        ::-webkit-scrollbar { 
            width: 4px; 
            height: 4px; 
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--color-border-hover);
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-text-muted);
        }
        
        /* Selection styling */
        ::selection {
            background: var(--color-accent);
            color: var(--color-bg);
        }
        
        /* Smooth transitions for interactive elements */
        a, button, input, select, textarea {
            transition: all 0.3s var(--transition-elegant);
        }
        
        /* Border styling */
        .border-gray-800 {
            border-color: var(--color-border) !important;
        }
        
        .border-gray-700 {
            border-color: var(--color-border-hover) !important;
        }
        
        /* Background adjustments */
        .bg-gray-900\/50,
        .bg-\[\#111\] {
            background: var(--color-surface) !important;
        }
        
        /* ========================================
           LUXURY TYPOGRAPHY OVERRIDES
           ======================================== */
        .text-3xl {
            font-family: var(--font-display);
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.01em;
        }
        
        .text-2xl {
            font-family: var(--font-display);
            font-weight: 400;
        }
        
        .text-xl {
            font-family: var(--font-display);
            font-weight: 500;
        }
        
        .font-bold {
            font-weight: 500 !important;
        }
        
        /* Refined text colors */
        .text-gray-400 {
            color: var(--color-text-secondary) !important;
        }
        
        .text-gray-500 {
            color: var(--color-text-muted) !important;
        }
        
        /* Luxury card styling */
        .luxury-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            transition: all 0.5s var(--transition-elegant);
        }
        
        .luxury-card:hover {
            border-color: var(--color-border-hover);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Section dividers */
        .divider-elegant {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--color-border-hover), transparent);
        }
        
        /* Subtle glow effects */
        .glow-accent {
            box-shadow: 0 0 40px rgba(201, 169, 98, 0.1);
        }
        
        /* Price display */
        .price-display {
            font-family: var(--font-display);
            font-weight: 500;
            letter-spacing: 0.05em;
        }
        
        /* Form section labels */
        .section-label {
            font-family: var(--font-body);
            font-size: 0.65rem;
            font-weight: 500;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--color-text-muted);
        }
        
        /* Image treatments */
        .product-image {
            filter: saturate(0.95) contrast(1.02);
            transition: all 0.8s var(--transition-elegant);
        }
        
        .product-image:hover {
            filter: saturate(1) contrast(1.05);
        }
        
        /* Status indicators with luxury feel */
        .status-open {
            color: #7cb88c;
        }
        
        .status-closed {
            color: var(--color-text-muted);
        }
        
        /* Subtle animations */
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
            animation: shimmer 3s infinite;
        }
        
        /* Focus states */
        input:focus, textarea:focus, select:focus {
            outline: none;
        }
        
        /* Button hover states enhancement */
        .btn-primary:hover {
            transform: translateY(-1px);
        }
        
        .btn-secondary:hover {
            transform: translateY(-1px);
        }
        
        /* Modal overlays */
        .modal-overlay {
            background: rgba(10, 9, 8, 0.95);
            backdrop-filter: blur(8px);
        }
        
                /* Password field with eye icon */
        .password-field-wrapper {
            position: relative;
            width: 100%;
        }
        
        .password-field-wrapper input {
            padding-right: 40px;
        }
        
        .password-toggle {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            padding: 8px;
            font-size: 1.2rem;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .password-toggle:hover {
            opacity: 1;
        }
        
    </style>
</head>
<body>
    <!-- ========================================
         HEADER - PHASE 1 & 6
         ======================================== -->
    <header class="fixed top-0 left-0 right-0 z-50 px-6 py-6 flex justify-between items-center header-blur" id="mainHeader">
        <div class="cursor-pointer" onclick="navigateTo('home')" style="font-family: var(--font-display); font-size: 1rem; font-weight: 500; letter-spacing: 0.35em; font-style: italic;">
            WEARENFEEL
        </div>
        <button class="w-11 h-11 flex flex-col justify-center items-center gap-2 group" 
                onclick="toggleMenu()" 
                aria-label="Menu">
            <span class="w-6 h-[1px] bg-white/80 transition-all duration-300 group-hover:w-5 group-hover:bg-[#c9a962]" id="menuLine1"></span>
            <span class="w-4 h-[1px] bg-white/60 transition-all duration-300 group-hover:w-6 group-hover:bg-[#c9a962]" id="menuLine2"></span>
        </button>
    </header>

    <!-- ========================================
         MENU OVERLAY - PHASE 6
         ======================================== -->
    <div class="menu-overlay" id="menuOverlay">
        <button class="absolute top-5 right-5 w-10 h-10 flex items-center justify-center text-2xl opacity-50" 
                onclick="toggleMenu()">√ó</button>
        
        <nav class="w-full h-full flex flex-col justify-center items-center gap-10" id="dynamicMenuNav">
            <!-- Dynamic menu items rendered by JS -->
        </nav>
        
        <!-- Secret Admin Trigger - Triple Tap -->
        <div class="absolute bottom-12 left-0 right-0 flex justify-center items-center gap-2" 
             id="secretAdminBtn" 
             onclick="handleSecretTap()">
            <span class="w-6 h-0.5 bg-gray-600"></span>
            <span class="w-3 h-0.5 bg-gray-600"></span>
            <span class="w-10 h-0.5 bg-gray-600"></span>
        </div>
        
        <div class="absolute bottom-24 left-0 right-0 flex flex-col items-center gap-4 opacity-0 invisible transition-all duration-500" 
             id="adminSecretMenu">
            <a class="text-sm tracking-widest text-gray-500 cursor-pointer hover:text-white transition-colors" 
               onclick="goToAdmin()">ADMIN</a>
        </div>
    </div>

    <!-- ========================================
         PAGE: HOME - PHASE 1
         ======================================== -->
    <main class="page active" id="homePage">
        <div class="pt-20 pb-8">
            <!-- Tagline -->
            <p class="text-center py-6 px-8 text-sm italic" style="font-family: var(--font-display); color: var(--color-text-secondary); letter-spacing: 0.05em;">
                "Only one piece. One owner. No pressure."
            </p>
            <div class="product-grid" id="productGrid"></div>
        </div>
        
        <!-- Footer Links - Editorial Style -->
        <div class="px-8 pb-20 pt-16 flex flex-col items-center gap-6" style="background: linear-gradient(to top, rgba(10,9,8,1) 0%, transparent 100%);">
            <div class="w-24 h-[1px] mb-6" style="background: linear-gradient(90deg, transparent, var(--color-border-hover), transparent);"></div>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('policies')">POLICIES</button>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('privacy')">PRIVACY POLICY</button>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('terms')">TERMS & CONDITIONS</button>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('refund')">REFUND & CANCELLATION</button>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('shipping')">SHIPPING & DELIVERY</button>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('about')">ABOUT US</button>
            <button class="text-xs tracking-[0.25em] hover:tracking-[0.3em] text-gray-500 hover:text-[#c9a962] transition-all duration-500" 
                    style="font-family: var(--font-body); font-weight: 300;"
                    onclick="navigateTo('contact')">CONTACT</button>
            <div class="w-24 h-[1px] mt-6" style="background: linear-gradient(90deg, transparent, var(--color-border-hover), transparent);"></div>
            <p class="text-[10px] text-gray-600 mt-4 tracking-[0.3em]" style="font-family: var(--font-body); font-weight: 300;">WEARENFEEL ¬© 2024</p>
        </div>
    </main>

    <!-- ========================================
         PAGE: PRODUCT DETAIL - PHASE 1
         ======================================== -->
    <main class="page" id="productPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="fade-in" id="productContent"></div>
    </main>

    <!-- Fullscreen Gallery -->
    <div class="fullscreen-gallery flex items-center" id="fullscreenGallery">
        <button class="absolute top-6 right-6 z-10 text-white text-2xl opacity-60 w-10 h-10 flex items-center justify-center" 
                onclick="closeGallery()">√ó</button>
        <div class="absolute bottom-6 left-0 right-0 flex justify-center gap-2 z-10" id="galleryDots"></div>
        <div class="image-slider w-full h-full flex items-center" id="gallerySlider"></div>
    </div>

    <!-- ========================================
         PAGE: ADDRESS FORM - PHASE 2
         ======================================== -->
    <main class="page" id="addressPage">
    <button class="back-btn no-print" onclick="navigateTo('product', state.currentProduct?.id)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 12H5M10 17l-5-5 5-5"/>
        </svg>
    </button>
    <div class="pt-28 px-6 pb-32 fade-in">
        <h1 class="text-3xl font-bold tracking-brutal mb-4">Apply for Ownership</h1>
        <p class="text-muted mb-10">Enter your complete details to participate in the auction.</p>
        
        <form id="addressForm" class="space-y-4">
            <!-- Personal Information -->
            <div class="mb-6">
                <p class="text-sm text-muted mb-3 tracking-widest">PERSONAL INFORMATION</p>
                <div class="space-y-4">
                    <div>
                        <input type="text" id="fullName" placeholder="Full Legal Name *" required autocomplete="name">
                    </div>
                    <div>
                        <input type="email" id="email" placeholder="Email Address *" required autocomplete="email">
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <input type="tel" id="countryCode" placeholder="+91" value="+91" required autocomplete="tel-country-code" maxlength="4" oninput="validateCountryCode(this)">
                        </div>
                        <div class="flex-1">
                            <input type="tel" id="phoneNumber" placeholder="Phone Number *" required autocomplete="tel-national" maxlength="15" oninput="validatePhoneNumber(this)">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Shipping Address -->
            <div class="mb-6">
                <p class="text-sm text-muted mb-3 tracking-widest">SHIPPING ADDRESS</p>
                <div class="space-y-4">
                    <div>
                        <input type="text" id="addressLine1" placeholder="Street Address / House No. / Building *" required autocomplete="address-line1">
                    </div>
                    <div>
                        <input type="text" id="addressLine2" placeholder="Apartment, Suite, Unit (Optional)" autocomplete="address-line2">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <input type="text" id="city" placeholder="City *" required autocomplete="address-level2">
                        </div>
                        <div>
                            <input type="text" id="state" placeholder="State / Province *" required autocomplete="address-level1">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <input type="text" id="postalCode" placeholder="ZIP / Postal Code *" required autocomplete="postal-code" maxlength="10" oninput="validatePostalCode(this)">
                        </div>
                        <div>
                            <input type="text" id="country" placeholder="Country *" required autocomplete="country" value="India">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Additional Information -->
            <div class="mb-6">
                <p class="text-sm text-muted mb-3 tracking-widest">ADDITIONAL INFORMATION</p>
                <textarea id="specialInstructions" placeholder="Special instructions for delivery (Optional)" rows="2"></textarea>
            </div>
            
            <!-- Terms Agreement -->
            <div class="flex items-start gap-3 mb-4">
                <input type="checkbox" id="termsAgreement" class="mt-1 w-5 h-5" required>
                <label for="termsAgreement" class="text-sm text-gray-400 leading-relaxed">
                    I agree that all information provided is accurate and I understand that this information will be used for shipping and communication purposes only.
                </label>
            </div>
            
            <!-- Policy Agreement -->
            <div class="flex items-start gap-3 mb-8">
                <input type="checkbox" id="policyAgreement" class="mt-1 w-5 h-5" required>
                <label for="policyAgreement" class="text-sm text-gray-400 leading-relaxed">
                    I agree to all website policies, including the <a href="#" onclick="event.preventDefault(); navigateTo('privacy');" class="text-white underline hover:text-[#c9a962] transition-colors">Privacy Policy</a>, <a href="#" onclick="event.preventDefault(); navigateTo('terms');" class="text-white underline hover:text-[#c9a962] transition-colors">Terms &amp; Conditions</a>, and all payment, bidding, refund, and delivery rules.
                </label>
            </div>
        </form>
    </div>
    
    <div class="fixed bottom-0 left-0 right-0 p-4 no-print" style="background: linear-gradient(to top, #0a0a0a 80%, transparent);">
        <button class="btn-primary" onclick="continueApplication()">CONTINUE APPLICATION</button>
    </div>
</main>

    <!-- ========================================
         PAGE: DEPOSIT / REGISTRATION FEE - PHASE 1
         ======================================== -->
    <main class="page" id="depositPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-32 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-4">Registration Fee</h1>
            <p class="text-muted mb-8">A non-refundable registration fee is required to participate in this auction.</p>
            
            <div class="border border-gray-800 p-6 mb-6">
                <p class="text-sm text-muted mb-2 tracking-widest">MINIMUM DEPOSIT</p>
                <p class="text-4xl font-bold">‚Çπ<span id="depositAmount">5,000</span></p>
            </div>
            
            <div class="bg-gray-900/50 p-4 mb-6 text-sm text-gray-400 leading-relaxed">
                <p class="mb-2">‚Ä¢ This deposit secures your spot in the auction</p>
                <p class="mb-2">‚Ä¢ <span class="text-red-400 font-semibold">Non-refundable</span> registration fee</p>
                <p class="mb-2">‚Ä¢ Deducted from final price if you win</p>
                <p>‚Ä¢ If you win, remaining amount must be paid within 24 hours</p>
            </div>
            
            <p class="text-sm text-center text-gray-500 italic mb-8" style="font-family: var(--font-display);">
                After payment, you will create an account and receive a unique bid code.
            </p>
            
            <button class="btn-primary" onclick="processPayment()">PAY & REGISTER</button>
        </div>
    </main>

    <!-- ========================================
         PAGE: SIGN UP - PHASE 2
         ======================================== -->
    <main class="page" id="signupPage">
        <div class="pt-20 px-6 pb-16 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-4">Create Account</h1>
            <p class="text-muted mb-10">Payment confirmed. Please set up your account.</p>
            
            <form id="signupForm" onsubmit="event.preventDefault(); handleSignup();" class="space-y-6">
                <div>
                    <input type="text" id="signupIdentifier" placeholder="Email ID or Mobile Number *" required>
                </div>
                <div>
                   <div class="password-field-wrapper">
    <input type="password" id="signupPassword" placeholder="Create Password *" required minlength="6">
    <button type="button" class="password-toggle" onclick="togglePassword('signupPassword')">üëÅÔ∏è</button>
</div>
                </div>
                <button type="submit" class="btn-primary mt-8">CONTINUE / SIGN UP</button>
            </form>
        </div>
    </main>

    <!-- ========================================
         PAGE: OTP VERIFICATION - PHASE 3
         ======================================== -->
    <main class="page" id="otpPage">
        <div class="pt-20 px-6 pb-16 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-4">Verification</h1>
            <p class="text-muted mb-8">Enter the 6-digit OTP sent to <span id="otpDest" class="text-white">your contact</span></p>
            
            <form id="otpForm" onsubmit="event.preventDefault(); handleOTP();" class="space-y-6">
                <div>
                    <input type="text" id="otpInput" placeholder="Enter 6-digit OTP" required maxlength="6" pattern="\d{6}" class="text-center text-2xl tracking-[0.5em]">
                </div>
                <button type="submit" class="btn-primary mt-8">VERIFY OTP</button>
                <p class="text-center text-sm text-muted mt-4 cursor-pointer" onclick="alert('OTP resent!')">Resend OTP</p>
            </form>
        </div>
    </main>

    <!-- ========================================
         PAGE: USER LOGIN - PHASE 4
         ======================================== -->
    <main class="page" id="userLoginPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-4">Login</h1>
            <p class="text-muted mb-10">Welcome back to WEARENFEEL</p>
            
            <form id="userLoginForm" onsubmit="event.preventDefault(); handleUserLogin();" class="space-y-6">
                <div>
                    <input type="text" id="loginIdentifier" placeholder="Email ID or Mobile Number" required>
                </div>
                <div>
                   <div class="password-field-wrapper">
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
</div>
                </div>
                <button type="submit" class="btn-primary mt-8">LOGIN</button>
            </form>
            <div class="text-center mt-6">
                 <p class="text-sm text-gray-500">Don't have an account?</p>
                 <button class="text-sm text-white underline mt-2" onclick="navigateTo('deposit')">Register for Bid</button>
            </div>
        </div>
    </main>

    <!-- ========================================
         PAGE: MY ACCOUNT - PHASE 7
         ======================================== -->
    <main class="page" id="myAccountPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-24 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-8">My Account</h1>
            
            <form id="myAccountForm" onsubmit="event.preventDefault(); saveAccountDetails();" class="space-y-6">
                <!-- Locked Fields -->
                <div class="space-y-4 border-b border-gray-800 pb-6">
                    <p class="text-xs text-muted tracking-widest uppercase">Contact Info (Locked)</p>
                    <div>
                        <input type="text" id="accEmail" class="locked-field" placeholder="Email ID" readonly>
                    </div>
                    <div>
                        <input type="text" id="accMobile" class="locked-field" placeholder="Mobile Number" readonly>
                    </div>
                </div>
                
                <!-- Editable Fields -->
                <div class="space-y-4">
                    <p class="text-xs text-muted tracking-widest uppercase">Personal Details</p>
                    <input type="text" id="accFullName" placeholder="Full Name" required>
                    <input type="text" id="accAddress" placeholder="Address">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" id="accCity" placeholder="City">
                        <input type="text" id="accState" placeholder="State">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" id="accCountry" placeholder="Country">
                        <input type="text" id="accPincode" placeholder="Pincode / ZIP">
                    </div>
                    
                    <div class="pt-4">
                        <p class="text-xs text-muted mb-2">Profile Photo (Optional URL)</p>
                        <input type="url" id="accPhoto" placeholder="Image URL">
                    </div>
                    
                    <div class="pt-4">
                        <p class="text-xs text-muted mb-2">Change Password</p>
                      <div class="password-field-wrapper">
    <input type="password" id="accNewPassword" placeholder="New Password (Leave blank to keep current)">
    <button type="button" class="password-toggle" onclick="togglePassword('accNewPassword')">üëÅÔ∏è</button>
</div>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary mt-8">SAVE CHANGES</button>
            </form>
            
            <!-- My Applications Section -->
            <div class="mt-12 pt-8 border-t border-gray-800">
                <h2 class="text-xl font-bold tracking-brutal mb-6">My Applications</h2>
                <div id="accountBidsList" class="space-y-4"></div>
            </div>
        </div>
    </main>

    <!-- ========================================
         PAGE: PLACE BID - PHASE 4
         ======================================== -->
    <main class="page" id="placeBidPage">
        <button class="back-btn no-print" onclick="navigateTo('product', state.currentProduct?.id)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-32 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-4">Place Your Bid</h1>
            
            <div class="border border-gray-800 p-4 mb-6">
                <p class="text-sm text-muted mb-1">Your Unique Code</p>
                <p class="bid-code-display" id="yourBidCode"></p>
            </div>
            
            <div class="border border-gray-800 p-4 mb-6">
                <p class="text-sm text-muted mb-1 tracking-widest">MINIMUM BID REQUIRED</p>
                <p class="text-2xl font-bold">‚Çπ<span id="minimumBidAmount">0</span></p>
            </div>
            
            <div class="mb-6">
                <label class="text-sm text-muted mb-3 block tracking-widest">ENTER YOUR BID AMOUNT</label>
                <div class="flex items-center gap-2">
                    <span class="text-2xl font-bold">‚Çπ</span>
                    <input type="number" 
                           id="bidAmountInput" 
                           placeholder="0" 
                           min="1" 
                           class="text-2xl font-bold flex-1" 
                           inputmode="numeric">
                </div>
            </div>
            
            <div class="border border-gray-800 p-4 mb-8 text-sm space-y-2" style="background: rgba(201, 169, 98, 0.03);">
                <p class="text-xs text-muted tracking-widest mb-3">BIDDING RULES</p>
                <p class="text-gray-400"><span class="text-white">‚Ä¢</span> Minimum bid = current highest + ‚Çπ100</p>
                <p class="text-gray-400"><span class="text-white">‚Ä¢</span> You can edit your bid <span class="text-white font-semibold">only once</span></p>
                <p class="text-gray-400"><span class="text-white">‚Ä¢</span> Highest bid wins</p>
                <p class="text-gray-400"><span class="text-white">‚Ä¢</span> Risk transfers to the buyer once the product is handed to the courier</p>
            </div>
            
            <button class="btn-primary" onclick="submitBid()">CONFIRM BID</button>
        </div>
    </main>

    <!-- ========================================
         PAGE: BID CONFIRMED - PHASE 5
         ======================================== -->
    <main class="page" id="confirmedPage">
        <div class="h-screen flex flex-col items-center justify-center px-8 fade-in" id="confirmedContent"></div>
    </main>

    <!-- ========================================
         PAGE: MY BIDS - PHASE 6
         ======================================== -->
    <main class="page" id="myBidsPage">
        <div class="pt-20 px-5 pb-8 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-2">My Bids</h1>
            <p class="text-muted mb-8">Track all your auction participations</p>
            <div class="space-y-4" id="myBidsList"></div>
        </div>
    </main>

    <!-- ========================================
         PAGE: ADMIN LOGIN - PHASE 7
         ======================================== -->
    <main class="page" id="adminLoginPage">
        <div class="h-screen flex flex-col justify-center px-8 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-2">Admin Access</h1>
            <p class="text-muted mb-10">Enter your credentials to continue</p>
            
            <form id="adminLoginForm" class="space-y-6" onsubmit="event.preventDefault(); adminLogin();">
                <input type="email" id="adminEmail" placeholder="Email" required autocomplete="email">
            <div class="password-field-wrapper">
    <input type="password" id="adminPassword" placeholder="Password" required autocomplete="current-password">
    <button type="button" class="password-toggle" onclick="togglePassword('adminPassword')">üëÅÔ∏è</button>
</div>
                <button type="submit" class="btn-primary mt-8">LOGIN</button>
            </form>
            
            <button class="w-full mt-4 py-3 text-muted text-sm" onclick="navigateTo('home')">Cancel</button>
        </div>
    </main>

    <!-- ========================================
         PAGE: ADMIN PANEL - PHASE 8, 9, 10, 11
         ======================================== -->
    <main class="page" id="adminPage">
        <div class="pt-24 pb-8 fade-in">
            <!-- Admin Tabs -->
            <div class="flex gap-6 px-6 mb-8 overflow-x-auto text-sm tracking-widest border-b border-gray-900">
                <button class="admin-tab pb-4 border-b-2 border-white flex-shrink-0 text-white" data-tab="dashboard">DASHBOARD</button>
                <button class="admin-tab pb-4 border-b-2 border-transparent flex-shrink-0 text-gray-500" data-tab="products">PRODUCTS</button>
                <button class="admin-tab pb-4 border-b-2 border-transparent flex-shrink-0 text-gray-500" data-tab="orders">ORDERS</button>
                <button class="admin-tab pb-4 border-b-2 border-transparent flex-shrink-0 text-gray-500" data-tab="customers">CUSTOMERS</button>
                <button class="admin-tab pb-4 border-b-2 border-transparent flex-shrink-0 text-gray-500" data-tab="bids">BIDS</button>
                <button class="admin-tab pb-4 border-b-2 border-transparent flex-shrink-0 text-gray-500" data-tab="applied">APPLIED</button>
            </div>
            
            <!-- Dashboard Tab - PHASE 8 -->
            <div class="admin-content px-6" id="adminDashboard">
                <div class="grid grid-cols-2 gap-3 mb-8">
                    <div class="admin-card">
                        <p class="text-3xl font-bold" id="statProducts">0</p>
                        <p class="text-sm text-gray-500 mt-1">Products Available</p>
                    </div>
                    <div class="admin-card">
                        <p class="text-3xl font-bold" id="statTotalBids">0</p>
                        <p class="text-sm text-gray-500 mt-1">Total Bids</p>
                    </div>
                    <div class="admin-card">
                        <p class="text-3xl font-bold text-green-500" id="statActiveBids">0</p>
                        <p class="text-sm text-gray-500 mt-1">Active Bids</p>
                    </div>
                    <div class="admin-card">
                        <p class="text-3xl font-bold text-gray-400" id="statClosedBids">0</p>
                        <p class="text-sm text-gray-500 mt-1">Closed Bids</p>
                    </div>
                    <div class="admin-card">
                        <p class="text-3xl font-bold" id="statVisitors">0</p>
                        <p class="text-sm text-gray-500 mt-1">Total Visitors</p>
                    </div>
                    <div class="admin-card">
                        <p class="text-3xl font-bold" id="statCustomers">0</p>
                        <p class="text-sm text-gray-500 mt-1">Customers</p>
                    </div>
                </div>
                
                <h2 class="text-lg font-bold mb-4">Recent Activity</h2>
                <div class="space-y-3" id="recentActivity"></div>
                
                <!-- Site Settings -->
                <div class="mt-10 pt-8 border-t border-gray-800">
                    <h2 class="text-lg font-bold mb-6">Site Settings</h2>
                    <div class="admin-card">
                        <div class="flex items-center justify-between gap-4">
                            <div>
                                <p class="font-semibold text-white mb-1">Bid Registration Fee</p>
                                <p class="text-sm text-gray-500">Default fee for bidding registration</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-lg text-gray-400">‚Çπ</span>
                                <input type="number" 
                                       id="settingsBidFee" 
                                       value=""
                                       min="0" 
                                       class="w-28 text-lg font-bold text-right bg-transparent border-b border-gray-700 focus:border-[#c9a962] py-2"
                                       onchange="updateBidRegistrationFee(this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Products Tab - PHASE 9 -->
            <div class="admin-content px-6 hidden" id="adminProducts">
                <button class="btn-primary mb-6 text-sm px-6 py-3" style="width: auto;" onclick="showAddProduct()">
                    + ADD PRODUCT
                </button>
                <div class="space-y-4" id="adminProductList"></div>
            </div>
            
            <!-- Orders Tab - PHASE 10 -->
            <div class="admin-content px-6 hidden" id="adminOrders">
                <div class="flex gap-3 mb-6 flex-wrap">
                    <button class="btn-secondary text-xs" onclick="selectAllOrders()">SELECT ALL</button>
                    <button class="btn-secondary text-xs" onclick="deselectAllOrders()">DESELECT ALL</button>
                    <button class="btn-primary text-xs py-2 px-4" style="width: auto;" onclick="printSelectedLabels()">PRINT LABELS</button>
                </div>
                <div class="space-y-4" id="adminOrderList"></div>
            </div>
            
            <!-- Customers Tab - PHASE 11 -->
            <div class="admin-content px-6 hidden" id="adminCustomers">
                <div class="flex justify-between items-center mb-6">
                    <p class="text-lg font-bold">Customer Database</p>
                    <p class="text-sm text-gray-500" id="customerCount">0 customers</p>
                </div>
                <div id="adminCustomerList" class="space-y-3"></div>
                <div id="adminCustomerDetail" class="hidden"></div>
            </div>
            
            <!-- Bids Tab - PHASE 11 -->
            <div class="admin-content px-6 hidden" id="adminBids">
                <div class="flex justify-between items-center mb-6">
                    <p class="text-lg font-bold">All Bids</p>
                    <p class="text-xs text-gray-500">Highest to lowest</p>
                </div>
                <div class="space-y-3" id="adminBidsList"></div>
            </div>
            
            <!-- Applied Tab - PHASE 11 -->
            <div class="admin-content px-6 hidden" id="adminApplied">
                <div class="mb-6">
                    <p class="text-lg font-bold mb-4">Applied Codes by Product</p>
                    <input type="text" id="appliedSearch" placeholder="Search by code..." oninput="renderAdminApplied()">
                </div>
                <div id="adminAppliedList" class="space-y-3"></div>
                <div id="adminAppliedDetail" class="hidden"></div>
                <div id="adminWinnerPicker" class="hidden"></div>
            </div>
        </div>
    </main>

    <!-- ========================================
         PRODUCT MODAL - PHASE 9
         ======================================== -->
    <div class="fixed inset-0 bg-black z-50 overflow-y-auto opacity-0 invisible transition-all duration-300" id="productModal">
        <div class="min-h-screen px-6 py-20">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-2xl font-bold" id="productModalTitle">Add Product</h2>
                <button class="w-10 h-10 flex items-center justify-center text-2xl opacity-60" onclick="closeProductModal()">√ó</button>
            </div>
            
            <form id="productForm" class="space-y-6">
                <input type="hidden" id="productId">
                <input type="text" id="productName" placeholder="Product Name" required>
                <input type="number" id="productPrice" placeholder="Price (‚Çπ)" required min="1">
                <textarea id="productDesc" placeholder="Description" rows="3"></textarea>
                <input type="text" id="productSizes" placeholder="Sizes (comma separated: S, M, L)">
                <input type="number" id="productStock" placeholder="Stock Quantity" required min="0" value="1">
                
                <div class="border border-gray-800 p-4 space-y-4">
                    <p class="text-sm text-muted tracking-widest">AUCTION SETTINGS</p>
                    
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="productIsAuction" checked class="w-5 h-5">
                        <span>Enable Auction / Bidding</span>
                    </label>
                    
                    <input type="number" id="productBidDeposit" placeholder="Bid Deposit (‚Çπ)" min="0" value="5000">
                    
                    <select id="productBidStatus" class="admin-select">
                        <option value="OPEN">BID STATUS: OPEN</option>
                        <option value="CLOSED">BID STATUS: CLOSED</option>
                    </select>
                    
                    <div>
                        <label class="text-sm text-muted block mb-2">Auto-Close Auction At (Optional)</label>
                        <input type="datetime-local" id="productAuctionEnd">
                    </div>
                </div>
                
                <div class="border border-gray-800 p-4 space-y-4">
                    <p class="text-sm text-muted tracking-widest">PRODUCT IMAGES</p>
                    
                    <input type="file" id="productImages" accept="image/*" multiple class="hidden" onchange="previewImages(event)">
                    <button type="button" onclick="document.getElementById('productImages').click()" class="btn-secondary w-full">
                        UPLOAD FROM DEVICE
                    </button>
                    
                    <div class="grid grid-cols-4 gap-2" id="imagePreview"></div>
                    
                    <textarea id="productImageUrls" placeholder="Or paste image URLs (one per line)" rows="2"></textarea>
                    <button type="button" class="btn-secondary w-full" onclick="addImagesFromUrls()">ADD URLS</button>
                </div>
                
                <input type="url" id="productVideoUrl" placeholder="Video URL (optional)">
            </form>
            
            <button class="btn-primary mt-10" onclick="saveProduct()">SAVE PRODUCT</button>
        </div>
    </div>

    <!-- ========================================
         STATIC PAGES
         ======================================== -->
    <!-- Policies Page -->
    <main class="page" id="policiesPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-6">Policies</h1>
            <p class="text-lg text-white mb-4" style="font-family: var(--font-display); font-style: italic;">WEARENFEEL</p>
            
            <div class="border border-gray-800 p-4 mb-10 text-sm text-gray-400 leading-relaxed" style="background: rgba(201, 169, 98, 0.03);">
                <p>By accessing, browsing, registering, bidding, or purchasing through this website, you agree to be legally bound by all policies mentioned below.</p>
                <p class="mt-2 text-white font-semibold">If you do not agree, do not use this website.</p>
            </div>
            
            <!-- 1. Nature of Products -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">1.</span> NATURE OF PRODUCTS (HANDMADE & LIMITED)</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>All WEARENFEEL products are <span class="text-white">handmade, limited, and often one-of-one</span>.</p>
                    <p>Once a product is completed, it will <span class="text-white">never be recreated</span>.</p>
                    <p>Due to the handmade nature, minor variations may occur, including but not limited to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Loose threads</li>
                        <li>Slight color differences</li>
                        <li>Stitch irregularities</li>
                        <li>Fabric texture variations</li>
                    </ul>
                    <p class="text-yellow-500/80 mt-3">‚ö†Ô∏è These are NOT considered defects or damage and do not qualify for return, refund, or replacement.</p>
                </div>
            </div>
            
            <!-- 2. Application & Ownership Process -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">2.</span> APPLICATION & OWNERSHIP PROCESS</h2>
                <div class="text-gray-400 leading-relaxed space-y-4 text-sm">
                    <div>
                        <p class="text-white font-semibold mb-2">2.1 Application for Ownership</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Applying does not guarantee ownership.</li>
                            <li>Application only allows participation in the auction.</li>
                        </ul>
                    </div>
                    <div>
                        <p class="text-white font-semibold mb-2">2.2 Registration / Bid Deposit</p>
                        <p>A registration deposit as displayed on the website at the time of application is required to participate.</p>
                        <p class="mt-2">The deposit:</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Secures auction eligibility</li>
                            <li>Is adjusted against final price if you win</li>
                            <li><span class="text-red-400 font-semibold">Is NON-REFUNDABLE</span> regardless of outcome</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- 3. Deposit Forfeiture Rules -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">3.</span> DEPOSIT FORFEITURE RULES</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>The deposit shall be <span class="text-red-400">immediately forfeited and non-refundable</span> if:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>You fail to place a bid after registering</li>
                        <li>You place invalid or manipulated bids</li>
                        <li>You violate bidding rules</li>
                        <li>You attempt multiple accounts or system misuse</li>
                        <li>You fail or refuse to complete payment after winning</li>
                    </ul>
                </div>
            </div>
            
            <!-- 4. Bidding Rules -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">4.</span> BIDDING RULES (FINAL & ENFORCEABLE)</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>First bid must be equal to or higher than product price</li>
                        <li>Each next bid must be higher than the current highest bid</li>
                        <li>Bids cannot be cancelled or withdrawn</li>
                        <li>Limited bid edits (if enabled) are final</li>
                        <li>Highest valid bid at auction close wins</li>
                    </ul>
                    <p class="mt-3">Any manipulation attempt results in:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1 text-red-400">
                        <li>Immediate disqualification</li>
                        <li>Loss of deposit</li>
                        <li>Permanent account termination</li>
                    </ul>
                    <p class="text-white font-semibold mt-3">Admin decision is final and non-negotiable.</p>
                </div>
            </div>
            
            <!-- 5. Failure to Pay After Winning -->
            <div class="mb-10 border border-red-900/30 p-4 rounded" style="background: rgba(220, 38, 38, 0.05);">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-red-400"><span class="text-gray-500">5.</span> FAILURE TO PAY AFTER WINNING (VERY IMPORTANT)</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>If a winning bidder <span class="text-red-400">fails, refuses, delays, or intentionally avoids payment</span> after winning:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>The bidder agrees to pay a penalty equal to the registration deposit as displayed on the website at the time of application</li>
                        <li>This penalty is legally recoverable</li>
                        <li>Deposit shall be forfeited immediately</li>
                        <li>Ownership rights will be cancelled</li>
                        <li>Account will be permanently banned</li>
                    </ul>
                    <p class="mt-3">WEARENFEEL reserves the right to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Re-auction the product</li>
                        <li>Offer to second-highest bidder (with no obligation)</li>
                        <li>Take legal or recovery action</li>
                    </ul>
                    <p class="text-yellow-500/80 mt-3">‚ö†Ô∏è Winning a bid creates a binding financial obligation.</p>
                    <p class="text-blue-400 mt-2">‚ÑπÔ∏è Second-highest bidder receives an optional offer with NO penalty if declined.</p>
                </div>
            </div>
            
            <!-- 6. Pricing & Payments -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">6.</span> PRICING & PAYMENTS</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>All prices are displayed in INR unless stated otherwise</li>
                        <li>Final payable amount = Winning bid ‚àí Deposit (if applicable)</li>
                    </ul>
                    <p class="mt-3">WEARENFEEL reserves the right to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Cancel transactions caused by technical or pricing errors</li>
                        <li>Reject suspicious or high-risk payments</li>
                    </ul>
                </div>
            </div>
            
            <!-- 7. No Return Policy -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">7.</span> NO RETURN POLICY (STRICT)</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p class="text-white font-semibold">WEARENFEEL follows a NO RETURN POLICY.</p>
                    <p class="mt-2">Returns are accepted only if:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Wrong product is delivered</li>
                        <li>Product is physically damaged during transit</li>
                    </ul>
                    <p class="mt-3 text-white">Conditions:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Issue must be reported within the timeline displayed on the website at the time of claim</li>
                        <li><span class="text-white">Unboxing video is mandatory</span></li>
                        <li>Claims without proof will be rejected</li>
                    </ul>
                </div>
            </div>
            
            <!-- 8. No Refund Policy -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex itemscenter gap-2"><span class="text-gray-500">8.</span> NO REFUND POLICY (ABSOLUTE)</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p class="text-white font-semibold">No refunds once order is confirmed</p>
                    <p class="mt-2">No refunds for:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Change of mind</li>
                        <li>Size or fit issues</li>
                        <li>Color preference</li>
                        <li>Handmade imperfections</li>
                        <li>Delivery delays</li>
                        <li>Customs or courier issues</li>
                    </ul>
                    <p class="mt-3">Exceptional refunds (if approved) will deduct:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Payment gateway charges</li>
                        <li>Platform fees</li>
                        <li>Shipping & packaging costs</li>
                        <li>Taxes, duties, and commissions</li>
                    </ul>
                </div>
            </div>
            
            <!-- 9. Shipping & Delivery -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">9.</span> SHIPPING & DELIVERY</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>Delivery timelines are <span class="text-white">estimated only</span></p>
                    <p class="mt-2">Delays due to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Handmade process</li>
                        <li>Courier failures</li>
                        <li>Customs delays</li>
                        <li>Natural events</li>
                    </ul>
                    <p class="mt-2">are <span class="text-white">not grounds for refund or cancellation</span></p>
                    <p class="mt-3">International buyers are responsible for:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Import duties</li>
                        <li>Customs clearance</li>
                        <li>Local regulations</li>
                    </ul>
                </div>
            </div>
            
            <!-- 10. Account Responsibility -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">10.</span> ACCOUNT RESPONSIBILITY</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Users are responsible for maintaining account security</li>
                        <li>Email and mobile number cannot be changed</li>
                        <li>False information may lead to account termination</li>
                    </ul>
                    <p class="mt-3">WEARENFEEL is not responsible for losses due to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>User negligence</li>
                        <li>Shared credentials</li>
                        <li>Unauthorized access from user side</li>
                    </ul>
                </div>
            </div>
            
            <!-- 11. Website, System & Security Disclaimer -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">11.</span> WEBSITE, SYSTEM & SECURITY DISCLAIMER</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>WEARENFEEL shall not be held liable for any loss arising from:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Website hacking</li>
                        <li>Data breach</li>
                        <li>Malware</li>
                        <li>Unauthorized access</li>
                        <li>Third-party service failures</li>
                        <li>Server or browser issues</li>
                    </ul>
                    <p class="text-white mt-3">Users access and use the website at their own risk.</p>
                </div>
            </div>
            
            <!-- 12. Admin Rights -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">12.</span> ADMIN RIGHTS (ABSOLUTE)</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>WEARENFEEL reserves the <span class="text-white">unrestricted right</span> to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Modify or cancel auctions</li>
                        <li>Reject applications</li>
                        <li>Cancel bids</li>
                        <li>Suspend or terminate accounts</li>
                        <li>Change product details</li>
                        <li>Update policies at any time</li>
                    </ul>
                    <p class="text-white font-semibold mt-3">Admin decisions are final and legally binding.</p>
                </div>
            </div>
            
            <!-- 13. Limitation of Liability -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">13.</span> LIMITATION OF LIABILITY</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>WEARENFEEL shall not be liable for:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Indirect or consequential losses</li>
                        <li>Emotional distress</li>
                        <li>Loss of opportunity</li>
                        <li>Business or personal loss</li>
                    </ul>
                    <p class="text-white mt-3">Maximum liability, if any, shall never exceed the amount paid by the user.</p>
                </div>
            </div>
            
            <!-- 14. Dispute Resolution & Jurisdiction -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">14.</span> DISPUTE RESOLUTION & JURISDICTION</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>All disputes shall be governed by <span class="text-white">Indian law</span></li>
                        <li>Jurisdiction shall lie exclusively in <span class="text-white">India</span></li>
                        <li>Users agree to attempt amicable resolution first</li>
                    </ul>
                </div>
            </div>
            
            <!-- 15. Policy Acceptance -->
            <div class="mb-10">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-gray-500">15.</span> POLICY ACCEPTANCE</h2>
                <div class="text-gray-400 leading-relaxed space-y-3 text-sm">
                    <p>By using this website, you confirm that:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>You have read and understood all policies</li>
                        <li>You agree voluntarily</li>
                        <li>Ignorance of policy is not a valid defense</li>
                        <li>These policies override all verbal or written communication</li>
                    </ul>
                </div>
            </div>
            
            <!-- Final Disclaimer -->
            <div class="border border-gray-800 p-6 text-center" style="background: rgba(201, 169, 98, 0.03);">
                <p class="text-lg mb-3" style="font-family: var(--font-display);">üîí FINAL DISCLAIMER</p>
                <p class="text-gray-400 text-sm leading-relaxed">WEARENFEEL operates on <span class="text-white">scarcity, control, and intentional creation</span>.</p>
                <p class="text-white font-semibold mt-3" style="font-family: var(--font-display); font-style: italic;">If this model does not suit you, do not participate.</p>
            </div>
        </div>
    </main>

    <!-- About Page -->
    <main class="page" id="aboutPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-12">About Us</h1>
            <div class="space-y-6 text-lg leading-relaxed">
                <p><span class="text-white font-bold text-2xl">WEARENFEEL</span> is a handmade clothing brand based in India.</p>
                <p class="text-gray-400">Every piece is handmade and created as a <span class="text-white font-semibold">limited one-of-one</span> product.</p>
                <p class="text-gray-400">Once a piece is completed, it is <span class="text-white font-semibold">never recreated</span>.</p>
                <div class="py-6 border-t border-b border-gray-800">
                    <p class="text-white font-semibold text-xl">This is intentional creation.</p>
                </div>
                <p class="text-gray-400">When you own a WEARENFEEL piece, you own something <span class="accent font-semibold">no one else will ever have</span>.</p>
            </div>
        </div>
    </main>

    <!-- Contact Page -->
    <main class="page" id="contactPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in">
            <h1 class="text-3xl font-bold tracking-brutal mb-12">Contact Us</h1>
            <div class="space-y-6">
                <a href="https://wa.me/919876543210" target="_blank" class="flex items-center gap-4 p-5 border border-gray-800 hover:border-gray-600 transition-colors">
                    <div class="w-12 h-12 flex items-center justify-center bg-green-500/10 rounded-full">
                        <span class="text-2xl">üí¨</span>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">WhatsApp</p>
                        <p class="text-lg">+91 9876543210</p>
                    </div>
                </a>
                <a href="mailto:wearenfeel@gmail.com" class="flex items-center gap-4 p-5 border border-gray-800 hover:border-gray-600 transition-colors">
                    <div class="w-12 h-12 flex items-center justify-center bg-blue-500/10 rounded-full">
                        <span class="text-2xl">‚úâÔ∏è</span>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Email</p>
                        <p class="text-lg">wearenfeel@gmail.com</p>
                    </div>
                </a>
                <a href="https://instagram.com/wearenfeel" target="_blank" class="flex items-center gap-4 p-5 border border-gray-800 hover:border-gray-600 transition-colors">
                    <div class="w-12 h-12 flex items-center justify-center bg-pink-500/10 rounded-full">
                        <span class="text-2xl">üì∏</span>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Instagram</p>
                        <p class="text-lg">@wearenfeel</p>
                    </div>
                </a>
            </div>
        </div>
    </main>

    <!-- Privacy Policy Page -->
    <main class="page" id="privacyPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold tracking-brutal mb-2">PRIVACY POLICY</h1>
            <p class="text-sm text-gray-500 mb-8">Last Updated: [Insert Date]</p>
            <div class="space-y-6 text-sm leading-relaxed text-gray-300">
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">1. Introduction</h3>
                    <p class="text-gray-400">This Privacy Policy explains how we collect, use, store, and protect your information when you access or use this website.</p>
                    <p class="text-gray-400 mt-1">By using this website, you explicitly consent to this Privacy Policy. If you do not agree, do not use the website.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">2. Information We Collect</h3>
                    <p class="text-gray-400">We may collect the following information:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>Full name</li>
                        <li>Email address</li>
                        <li>Mobile number</li>
                        <li>Shipping address</li>
                        <li>Device, browser, and usage data</li>
                        <li>Bidding and transaction history</li>
                        <li>We do not guarantee anonymity while using this website.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">3. Purpose of Data Collection</h3>
                    <p class="text-gray-400">Your data is used strictly for:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>User verification</li>
                        <li>Auction participation</li>
                        <li>Bid tracking</li>
                        <li>Order processing</li>
                        <li>Shipping and delivery</li>
                        <li>Legal compliance</li>
                        <li>Fraud prevention</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">4. Data Sharing</h3>
                    <p class="text-gray-400">We do not sell personal data.</p>
                    <p class="text-gray-400 mt-1">However, we may share data with:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>Payment gateways</li>
                        <li>Delivery partners</li>
                        <li>Legal authorities (if required)</li>
                        <li>Technical or security service providers</li>
                    </ul>
                    <p class="text-gray-400 mt-2">This sharing does not require additional consent.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">5. Data Storage & Security</h3>
                    <p class="text-gray-400">We take reasonable steps to protect data. However:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>No system is 100% secure</li>
                        <li>We are not liable for data breaches, hacking, malware, or unauthorized access</li>
                        <li>Use of this website is at your own risk</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">6. User Responsibility</h3>
                    <p class="text-gray-400">You are responsible for:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>Accuracy of your data</li>
                        <li>Keeping login credentials secure</li>
                    </ul>
                    <p class="text-gray-400 mt-2">We are not responsible for misuse caused by your negligence.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">7. Policy Changes</h3>
                    <p class="text-gray-400">This policy may change at any time without notice. Continued use means acceptance.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">8. Contact</h3>
                    <p class="text-gray-400">For privacy concerns, contact via the website‚Äôs official contact method.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Terms & Conditions Page -->
    <main class="page" id="termsPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold tracking-brutal mb-2">TERMS & CONDITIONS</h1>
            <p class="text-sm text-gray-500 mb-8">Last Updated: [Insert Date]</p>
            <div class="space-y-6 text-sm leading-relaxed text-gray-300">
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">1. Acceptance of Terms</h3>
                    <p class="text-gray-400">By accessing, registering, bidding, or purchasing through this website, you legally agree to all terms stated here. If you do not agree, leave immediately.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">2. Nature of Products</h3>
                    <p class="text-gray-400">Products are handmade, limited, and often one-of-one.</p>
                    <p class="text-gray-400">Minor imperfections such as loose threads, stitch variation, color difference, or texture irregularities are NOT defects and do NOT qualify for refund, replacement, or cancellation.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">3. Application & Auction System</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>Applying does not guarantee ownership</li>
                        <li>Registration allows participation only</li>
                        <li>Ownership is granted only after winning and full payment</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">4. Registration / Bid Deposit</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>A mandatory registration deposit is required</li>
                        <li>The deposit is NON-REFUNDABLE under all circumstances</li>
                        <li>Deposit may be adjusted against final price only if you win</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">5. Bidding Rules</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>First bid must meet or exceed the listed price</li>
                        <li>Each new bid must be higher than the current highest bid</li>
                        <li>Bids cannot be cancelled or withdrawn</li>
                        <li>Bid manipulation, fake bidding, or system abuse results in immediate disqualification</li>
                        <li>Admin decisions are final and binding.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">6. Failure to Pay After Winning</h3>
                    <p class="text-gray-400">If a winning bidder fails, delays, refuses, or avoids payment:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>Registration deposit is forfeited</li>
                        <li>A penalty equal to the registration deposit as displayed on the website at the time of application becomes payable</li>
                        <li>Legal recovery action may be initiated</li>
                        <li>Account will be permanently banned</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">7. Account Abuse</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>Multiple accounts, fake identities, or system exploitation will result in immediate termination, loss of deposits, and legal action if necessary</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">8. Limitation of Liability</h3>
                    <p class="text-gray-400">We are not liable for:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400 mt-2">
                        <li>Technical failures</li>
                        <li>Website downtime</li>
                        <li>Payment gateway issues</li>
                        <li>Internet delays</li>
                        <li>Loss of opportunity or profits</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">9. Governing Law</h3>
                    <p class="text-gray-400">These terms are governed by applicable local laws. Jurisdiction rests solely with the website owner.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Refund & Cancellation Page -->
    <main class="page" id="refundPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold tracking-brutal mb-2">REFUND & CANCELLATION POLICY</h1>
            <p class="text-sm text-gray-500 mb-8">Last Updated: [Insert Date]</p>
            <div class="space-y-6 text-sm leading-relaxed text-gray-300">
                <p class="text-red-400 font-semibold">NO REFUNDS. NO CANCELLATIONS. READ CAREFULLY.</p>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">1. Registration Fees</h3>
                    <p class="text-gray-400">Registration / bid deposits are STRICTLY NON-REFUNDABLE</p>
                    <p class="text-gray-400">No exceptions, including:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>Not winning</li>
                        <li>Changing mind</li>
                        <li>Technical errors</li>
                        <li>Payment mistakes</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">2. Product Orders</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>Once an order is confirmed: No cancellation, no refund, no exchange</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">3. Handmade Disclaimer</h3>
                    <p class="text-gray-400">Minor imperfections are expected and accepted. They do not qualify as damage.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">4. Payment Deductions</h3>
                    <p class="text-gray-400">If any refund is granted solely at admin discretion (rare):</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>Platform fees</li>
                        <li>Payment gateway fees</li>
                        <li>Taxes</li>
                        <li>Shipping & handling</li>
                        <li>Packaging costs</li>
                    </ul>
                    <p class="text-gray-400">will be deducted.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">5. Chargebacks</h3>
                    <p class="text-gray-400">Any chargeback attempt will result in:</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                        <li>Permanent account ban</li>
                        <li>Legal action</li>
                        <li>Recovery of losses</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Shipping & Delivery Page -->
    <main class="page" id="shippingPage">
        <button class="back-btn no-print" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 12H5M10 17l-5-5 5-5"/>
            </svg>
        </button>
        <div class="pt-20 px-6 pb-16 fade-in max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold tracking-brutal mb-2">SHIPPING & DELIVERY POLICY</h1>
            <p class="text-sm text-gray-500 mb-8">Last Updated: [Insert Date]</p>
            <div class="space-y-6 text-sm leading-relaxed text-gray-300">
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">1. Processing Time</h3>
                    <p class="text-gray-400">Products are handmade. Processing may take 1 day to several weeks. Delays do not qualify for refunds.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">2. Shipping Coverage</h3>
                    <p class="text-gray-400">We may ship domestically and internationally depending on availability.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">3. Delivery Timeline</h3>
                    <p class="text-gray-400">Delivery timelines are estimates only. We are not responsible for delays caused by couriers, customs, weather, strikes, or government actions.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">4. Address Accuracy</h3>
                    <p class="text-gray-400">You are responsible for providing correct address details. We are not liable for wrong address, failed delivery, or returned shipments.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">5. Lost or Damaged Shipments</h3>
                    <p class="text-gray-400">Once handed to courier, risk transfers to the buyer. Claims must be raised with the courier.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-2">6. Customs & Duties</h3>
                    <p class="text-gray-400">International buyers are responsible for customs duties, import taxes, and clearance charges.</p>
                </div>
                <div class="border border-gray-800 p-4 rounded-lg bg-black/20">
                    <p class="text-sm text-gray-400 font-semibold">FINAL LEGAL DISCLAIMER (IMPORTANT)</p>
                    <p class="text-xs text-gray-500 mt-1">Website content, pricing, rules, and availability may change without notice. Admin decisions are final. Website owner is not responsible for user assumptions or misunderstandings.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Print Container -->
    <div class="hidden" id="printContainer"></div>

    <!-- ========================================
         JAVASCRIPT - ALL PHASES
         ======================================== -->
    <script>
        
            /**
     * PASSWORD TOGGLE FUNCTION
     */
    function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const button = input.nextElementSibling;
        
        if (input.type === 'password') {
            input.type = 'text';
            button.textContent = 'üôà';
        } else {
            input.type = 'password';
            button.textContent = 'üëÅÔ∏è';
        }
    }
        
    // Backend base URL (single source of truth)
    const API_BASE = "https://new-hb6z.onrender.com";

    /**
     * Backend sync helpers (products, bids, deposits)
     */
    async function loadBackendProducts() {
        try {
            const res = await fetch(`${API_BASE}/products`, { credentials: 'include' });
            if (!res.ok) return;
            const data = await res.json();
            if (Array.isArray(data) && data.length) {
                state.products = data;
                saveState();
                renderHome();
            }
        } catch (e) {}
    }

    async function loadBackendBids() {
        try {
            const res = await fetch(`${API_BASE}/bids`, { credentials: 'include' });
            if (!res.ok) return;
            const data = await res.json();
            if (Array.isArray(data)) {
                state.bids = data;
                saveState();
            }
        } catch (e) {}
    }

    async function recordDeposit(productId, amount) {
        try {
            await fetch(`${API_BASE}/deposits`, {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId, amount })
            });
        } catch (e) {}
    }

    async function loadBackendOrders() {
        try {
            const res = await fetch(`${API_BASE}/orders`, { credentials: 'include' });
            if (!res.ok) return;
            const data = await res.json();
            if (Array.isArray(data)) {
                state.orders = data;
                saveState();
            }
        } catch (e) {}
    }

    async function syncProduct(product, isUpdate = false) {
        try {
            await fetch(`${API_BASE}/products${isUpdate ? `/${product.id}` : ''}`, {
                method: isUpdate ? 'PUT' : 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(product)
            });
        } catch (e) {}
    }

    async function syncBid(bid) {
        try {
            await fetch(`${API_BASE}/bids`, {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bid)
            });
        } catch (e) {}
    }

    async function syncBidUpdate(bid) {
        try {
            await fetch(`${API_BASE}/bids/${bid.id}`, {
                method: 'PATCH',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bid)
            });
        } catch (e) {}
    }

    async function syncOrder(order) {
        try {
            await fetch(`${API_BASE}/orders`, {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(order)
            });
        } catch (e) {}
    }

    /**
     * ========================================
     * APPLICATION STATE
     * ========================================
     */
    const state = {
        products: [],
        bids: [],
        orders: [],
        user: null, // Logged in user session
        registeredUsers: [], // "Database" of users
        currentProduct: null,
        checkoutData: {
            size: null,
            address: null,
            paymentMethod: 'upi',
            pendingSignup: null, // Store temp data during registration flow
            paymentConfirmed: false,
            targetProductId: null
        },
        pendingBid: null,
        lastConfirmedBid: null,
        isAdmin: false,
        cardHeights: {},
        appliedContext: { view: 'list', productId: null },
        settings: {
            bidRegistrationFee: 100,
            bidIncrement: 100,
            winnerPaymentHours: 24
        },
        deposits: [], // product IDs with paid registration
        _hydrated: false
    };

    let bidCodeStore = {};
    let tempImages = [];

    /**
     * ========================================
     * INITIALIZATION
     * ========================================
     */
    function init() {
        loadState();
        trackVisitor();
        renderHome();
        updateAdminUI();
        checkAuctionEndTimes();
        setInterval(checkAuctionEndTimes, 60000);
        // Try to hydrate data from backend
        loadBackendProducts();
        loadBackendBids();
        loadBackendOrders();
    }

    function loadState() {
        try {
            const saved = localStorage.getItem('wearenfeelState');
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed.products?.length) state.products = parsed.products;
                if (parsed.bids) state.bids = parsed.bids;
                if (parsed.orders) state.orders = parsed.orders;
                if (parsed.user) state.user = parsed.user;
                if (parsed.registeredUsers) state.registeredUsers = parsed.registeredUsers;
                else state.registeredUsers = [];
                if (parsed.isAdmin) state.isAdmin = parsed.isAdmin;
                if (parsed.cardHeights) state.cardHeights = parsed.cardHeights;
                if (parsed.settings) state.settings = { ...state.settings, ...parsed.settings };
            } else {
                state.registeredUsers = [];
            }
            
            const codes = localStorage.getItem('bidCodes');
            if (codes) bidCodeStore = JSON.parse(codes);
        } catch (e) {
            console.error('Error loading state:', e);
            state.registeredUsers = [];
        }
        
        // Mark hydrated once load completes
        state._hydrated = true;
        
        if (!state.products.length) {
            state.products = getDemoProducts();
            saveState();
        }
    }

    function saveState() {
        try {
            localStorage.setItem('wearenfeelState', JSON.stringify({
                products: state.products,
                bids: state.bids,
                orders: state.orders,
                user: state.user,
                registeredUsers: state.registeredUsers || [],
                isAdmin: state.isAdmin,
                cardHeights: state.cardHeights,
                settings: state.settings
            }));
            localStorage.setItem('bidCodes', JSON.stringify(bidCodeStore));
        } catch (e) {
            console.error('Error saving state:', e);
        }
    }

    function getDemoProducts() {
        const products = [
            { id: 1, name: 'Silk WEARENFEEL Blouse', price: 12500, description: 'Whispers of midnight silk against bare skin.', sizes: ['XS', 'S', 'M', 'L'], stock: 3, images: ['https://images.unsplash.com/photo-1551488831-00ddcb6c6bd3?w=600&h=800&fit=crop', 'https://images.unsplash.com/photo-1551488831-36e6f0a42c45?w=600&h=800&fit=crop'], isAuction: true, bidDeposit: 5000, bidStatus: 'OPEN' },
            { id: 2, name: 'Velvet Dreams Coat', price: 28900, description: 'Heavy luxury. Drapes like shadow.', sizes: ['S', 'M', 'L'], stock: 1, images: ['https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=600&h=900&fit=crop'], isAuction: true, bidDeposit: 5000, bidStatus: 'OPEN' },
            { id: 3, name: 'Raw Edge Trousers', price: 8900, description: 'Imperfection is the new perfect.', sizes: ['28', '30', '32', '34'], stock: 7, images: ['https://images.unsplash.com/photo-1594938298603-c8148c4dae35?w=600&h=750&fit=crop'], isAuction: true, bidDeposit: 5000, bidStatus: 'OPEN' },
            { id: 4, name: 'Minimalist Tee', price: 4500, description: 'Essential. Nothing more.', sizes: ['S', 'M', 'L', 'XL'], stock: 12, images: ['https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=600&h=700&fit=crop'], isAuction: true, bidDeposit: 5000, bidStatus: 'OPEN' },
            { id: 5, name: 'Architectural Blazer', price: 34500, description: 'Structure meets fluidity.', sizes: ['S', 'M', 'L'], stock: 2, images: ['https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=600&h=850&fit=crop'], isAuction: true, bidDeposit: 5000, bidStatus: 'OPEN' },
            { id: 6, name: 'Linen Shadow Dress', price: 18700, description: 'Flows like poetry, rests like silence.', sizes: ['XS', 'S', 'M'], stock: 0, images: ['https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=600&h=900&fit=crop'], isAuction: true, bidDeposit: 5000, bidStatus: 'OPEN' }
        ];
        
        products.forEach(p => {
            state.cardHeights[p.id] = 260 + Math.floor(Math.random() * 100);
        });
        
        return products;
    }

    /**
     * ========================================
     * VISITOR TRACKING - PHASE 8
     * ========================================
     */
    function trackVisitor() {
        if (sessionStorage.getItem('visitorCounted')) return;
        
        let count = parseInt(localStorage.getItem('visitorCount') || '0', 10);
        count++;
        localStorage.setItem('visitorCount', count.toString());
        sessionStorage.setItem('visitorCounted', 'true');
    }

    function getVisitorCount() {
        return parseInt(localStorage.getItem('visitorCount') || '0', 10);
    }

    /**
     * ========================================
     * NAVIGATION - ALL PHASES
     * ========================================
     */
    function requireLogin() {
        if (!state.user) {
            navigateTo('userLoginPage');
            return false;
        }
        return true;
    }

    function navigateTo(page, data = null, options = {}) {
        // Hide all pages
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        
        // Show header by default
        const header = document.getElementById('mainHeader');
        if (header) header.style.display = 'flex';
        
        // Push history state
        if (!options.skipHistory) {
            try {
                history.pushState({ page, data }, '', `#${page}`);
            } catch (e) {}
        }
        
        switch (page) {
            case 'home':
                document.getElementById('homePage').classList.add('active');
                renderHome();
                break;
                
            case 'product':
                if (data) state.currentProduct = state.products.find(p => p.id === data);
                // Track target product for deposit flow
                if (state.currentProduct?.id) {
                    state.checkoutData.targetProductId = state.currentProduct.id;
                    saveState();
                }
                document.getElementById('productPage').classList.add('active');
                renderProduct();
                break;
                
            case 'address':
                // Ensure target product is remembered
                if (state.currentProduct?.id) {
                    state.checkoutData.targetProductId = state.currentProduct.id;
                    saveState();
                }
                document.getElementById('addressPage').classList.add('active');
                prefillAddressForm();
                break;
                
            case 'deposit':
                if (header) header.style.display = 'none';
                document.getElementById('depositPage').classList.add('active');
                renderDepositPage();
                break;
                
            case 'placeBid':
                if (header) header.style.display = 'none';
                document.getElementById('placeBidPage').classList.add('active');
                renderPlaceBidPage();
                break;
                
            case 'confirmed':
                if (header) header.style.display = 'none';
                document.getElementById('confirmedPage').classList.add('active');
                renderConfirmedPage();
                break;
                
            case 'myBids':
                document.getElementById('myBidsPage').classList.add('active');
                renderMyBids();
                break;
                
            case 'adminLogin':
                if (state.isAdmin) {
                    navigateTo('admin');
                } else {
                    document.getElementById('adminLoginPage').classList.add('active');
                }
                break;
                
            case 'admin':
                if (!state.isAdmin) {
                    navigateTo('adminLogin');
                    return;
                }
                document.getElementById('adminPage').classList.add('active');
                renderAdminDashboard();
                break;
                
            case 'policies':
                document.getElementById('policiesPage').classList.add('active');
                break;
                
            case 'about':
                document.getElementById('aboutPage').classList.add('active');
                break;
                
            case 'contact':
                document.getElementById('contactPage').classList.add('active');
                break;
            
            case 'privacy':
                document.getElementById('privacyPage').classList.add('active');
                break;

            case 'terms':
                document.getElementById('termsPage').classList.add('active');
                break;

            case 'refund':
                document.getElementById('refundPage').classList.add('active');
                break;

            case 'shipping':
                document.getElementById('shippingPage').classList.add('active');
                break;
            
            case 'signup':
                if (!state.checkoutData.paymentConfirmed) {
                    alert('Please complete registration payment first.');
                    navigateTo('deposit');
                    return;
                }
                if (header) header.style.display = 'none';
                document.getElementById('signupPage').classList.add('active');
                break;
            
            case 'otp':
                if (!state.checkoutData.paymentConfirmed || !state.checkoutData.pendingSignup) {
                    alert('Please complete payment and signup first.');
                    navigateTo('signup');
                    return;
                }
                if (header) header.style.display = 'none';
                document.getElementById('otpPage').classList.add('active');
                break;
            
            case 'userLoginPage':
                document.getElementById('userLoginPage').classList.add('active');
                break;
            
            case 'myAccount':
                if (!requireLogin()) return;
                document.getElementById('myAccountPage').classList.add('active');
                renderMyAccount();
                break;
                
            default:
                navigateTo('home');
        }
    }

    // Handle browser back/forward
    window.addEventListener('popstate', (e) => {
        const st = e.state;
        if (st && st.page) {
            navigateTo(st.page, st.data, { skipHistory: true });
        } else {
            navigateTo('home', null, { skipHistory: true });
        }
    });

    /**
     * ========================================
     * MENU - PHASE 6
     * ========================================
     */
    function toggleMenu() {
        const overlay = document.getElementById('menuOverlay');
        overlay.classList.toggle('active');
        
        // Render dynamic menu when opening
        if (overlay.classList.contains('active')) {
            renderDynamicMenu();
        }
    }
    
    function renderDynamicMenu() {
        const nav = document.getElementById('dynamicMenuNav');
        if (!nav) return;
        
        let menuHTML = '';
        
        // Always show Home and Products
        menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" onclick="navigateTo('home'); toggleMenu();">Home</a>`;
        menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" onclick="navigateTo('home'); toggleMenu();">Products</a>`;
        
        if (state.user) {
            // User IS logged in
            menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" onclick="navigateTo('myAccount'); toggleMenu();">My Account</a>`;
            menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" onclick="navigateTo('myBids'); toggleMenu();">My Bids</a>`;
            menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" style="color: var(--color-text-muted);" onclick="handleLogout(); toggleMenu();">Logout</a>`;
        } else {
            // User is NOT logged in
            menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" onclick="navigateTo('deposit'); toggleMenu();">Register for Bid</a>`;
            menuHTML += `<a class="text-4xl tracking-brutal menu-link cursor-pointer" onclick="navigateTo('userLoginPage'); toggleMenu();">Login</a>`;
        }
        
        // Admin links (only if admin)
        if (state.isAdmin) {
            menuHTML += `<a class="text-2xl tracking-brutal menu-link cursor-pointer mt-6 text-gray-500" onclick="navigateTo('admin'); toggleMenu();">Admin Panel</a>`;
        }
        
        nav.innerHTML = menuHTML;
    }

    // Secret admin trigger - Triple tap
    let secretTapCount = 0;
    let secretTapTimer = null;

    function handleSecretTap() {
        secretTapCount++;
        
        if (secretTapTimer) clearTimeout(secretTapTimer);
        secretTapTimer = setTimeout(() => { secretTapCount = 0; }, 1500);
        
        if (secretTapCount >= 3) {
            document.getElementById('adminSecretMenu').classList.remove('opacity-0', 'invisible');
            secretTapCount = 0;
        }
    }

    function goToAdmin() {
        document.getElementById('adminSecretMenu').classList.add('opacity-0', 'invisible');
        toggleMenu();
        navigateTo(state.isAdmin ? 'admin' : 'adminLogin');
    }

    function updateAdminUI() {
        const panel = document.getElementById('menuAdminPanel');
        const logout = document.getElementById('menuAdminLogout');
        const secretBtn = document.getElementById('secretAdminBtn');
        
        if (state.isAdmin) {
            panel?.classList.remove('hidden');
            logout?.classList.remove('hidden');
            secretBtn?.classList.add('hidden');
        } else {
            panel?.classList.add('hidden');
            logout?.classList.add('hidden');
            secretBtn?.classList.remove('hidden');
        }
    }

    /**
     * ========================================
     * PHASE 1: HOME PAGE
     * ========================================
     */
    function renderHome() {
        const grid = document.getElementById('productGrid');
        if (!grid) return;
        
        if (!state.products.length) {
            grid.innerHTML = '<p class="text-center text-gray-500 col-span-2 py-12">No products available.</p>';
            return;
        }
        
        grid.innerHTML = state.products.map(p => {
            const h = state.cardHeights[p.id] || 300;
            const isSold = p.stock === 0;
            
            return `
                <div class="product-card" style="height:${h}px;" onclick="navigateTo('product', ${p.id})">
                    <img src="${p.images[0]}" class="w-full h-full object-cover" loading="lazy" alt="${p.name}">
                    <div class="price-tag">‚Çπ${p.price.toLocaleString()}</div>
                    ${isSold ? '<div class="sold-stamp">SOLD</div>' : ''}
                </div>
            `;
        }).join('');
    }

    /**
     * ========================================
     * PHASE 1: PRODUCT PAGE
     * ========================================
     */
    function renderProduct() {
        const product = state.currentProduct;
        if (!product) return;
        
        const container = document.getElementById('productContent');
        
        // Image slider
        const imagesHTML = product.images.map((img, i) => `
            <div class="image-slide">
                <img src="${img}" class="w-full h-[70vh] object-cover cursor-pointer" onclick="openGallery(${i})" alt="${product.name}">
            </div>
        `).join('');
        
        // Size buttons
        const sizesHTML = product.sizes?.length ? `
            <div class="mb-6">
                <p class="text-sm text-muted mb-3 tracking-widest">SELECT SIZE</p>
                <div class="flex flex-wrap gap-2">
                    ${product.sizes.map(s => `
                        <button class="size-btn border border-gray-800 px-4 py-2 ${state.checkoutData.size === s ? 'selected' : ''}" 
                                onclick="selectSize('${s}')">${s}</button>
                    `).join('')}
                </div>
            </div>
        ` : '';
        
        // Check if user already registered for this product
        const existingBid = state.user?.email ? 
            state.bids.find(b => b.productId === product.id && b.email === state.user.email) : null;
        const hasDeposit = state.deposits.includes(product.id);
        
        // Button logic
        let buttonHTML = '';
        if (product.stock === 0) {
            buttonHTML = '<button class="btn-primary" disabled>SOLD OUT</button>';
        } else if (product.bidStatus === 'CLOSED') {
            buttonHTML = '<button class="btn-primary" disabled>BIDDING CLOSED</button>';
        } else if (existingBid) {
            buttonHTML = '<button class="btn-primary" onclick="goToPlaceBid()">PLACE / EDIT BID</button>';
        } else if (!hasDeposit) {
            buttonHTML = '<button class="btn-primary" onclick="navigateTo(\'address\')">REGISTER FOR BID</button>';
        } else if (state.user) {
            buttonHTML = '<button class="btn-primary" onclick="goToPlaceBid()">PLACE BID</button>';
        } else {
            // If logged in, go directly to deposit page; otherwise go to address form first
            if (state.user) {
                buttonHTML = '<button class="btn-primary" onclick="navigateTo(\'deposit\')">REGISTER FOR BID</button>';
            } else {
                buttonHTML = '<button class="btn-primary" onclick="navigateTo(\'address\')">REGISTER FOR BID</button>';
            }
        }
        
        container.innerHTML = `
            <div class="image-slider" id="productSlider">${imagesHTML}</div>
            <div class="px-6 py-6">
                <div class="flex items-start justify-between gap-4 mb-4">
                    <h1 class="text-2xl font-bold tracking-brutal">${product.name}</h1>
                    <p class="text-xl font-bold flex-shrink-0">‚Çπ${product.price.toLocaleString()}</p>
                </div>
                <p class="text-gray-400 leading-relaxed mb-6">${product.description || ''}</p>
                ${sizesHTML}
                
                ${product.isAuction ? `
                    <div class="border border-gray-800 p-4 mb-6">
                        <p class="text-sm text-muted tracking-widest mb-1">AUCTION STATUS</p>
                        <p class="text-lg font-bold ${product.bidStatus === 'OPEN' ? 'text-green-500' : 'text-gray-500'}">
                            ${product.bidStatus === 'OPEN' ? 'OPEN FOR BIDS' : 'CLOSED'}
                        </p>
                        <p class="text-xs text-gray-500 mt-2">Registration: ‚Çπ${(product.bidDeposit || 5000).toLocaleString()}</p>
                    </div>
                ` : ''}
            </div>
        `;
        
        // Add fixed button at bottom
        let btnContainer = document.getElementById('productBuyBtn');
        if (!btnContainer) {
            btnContainer = document.createElement('div');
            btnContainer.id = 'productBuyBtn';
            btnContainer.className = 'fixed bottom-0 left-0 right-0 p-4 no-print';
            btnContainer.style.background = 'linear-gradient(to top, #0a0a0a 80%, transparent)';
            document.getElementById('productPage').appendChild(btnContainer);
        }
        btnContainer.innerHTML = buttonHTML;
    }

    function selectSize(size) {
        state.checkoutData.size = size;
        document.querySelectorAll('.size-btn').forEach(btn => {
            btn.classList.toggle('selected', btn.textContent === size);
        });
    }

    function startApplication() {
        // Deprecated in favor of Registration Flow
        navigateTo('deposit');
    }

    /**
     * ========================================
     * GALLERY
     * ========================================
     */
    let currentGalleryIndex = 0;

    function openGallery(index = 0) {
        const product = state.currentProduct;
        if (!product) return;
        
        currentGalleryIndex = index;
        const gallery = document.getElementById('fullscreenGallery');
        const slider = document.getElementById('gallerySlider');
        const dots = document.getElementById('galleryDots');
        
        slider.innerHTML = product.images.map(img => `
            <div class="image-slide flex items-center justify-center">
                <img src="${img}" class="max-h-screen w-full object-contain">
            </div>
        `).join('');
        
        dots.innerHTML = product.images.map((_, i) => `
            <div class="dot-indicator ${i === currentGalleryIndex ? 'active' : ''}"></div>
        `).join('');
        
        gallery.classList.add('active');
        slider.scrollTo({ left: slider.clientWidth * currentGalleryIndex, behavior: 'instant' });
        
        // Update dots on scroll
        slider.onscroll = () => {
            const newIndex = Math.round(slider.scrollLeft / slider.clientWidth);
            if (newIndex !== currentGalleryIndex) {
                currentGalleryIndex = newIndex;
                dots.querySelectorAll('.dot-indicator').forEach((dot, i) => {
                    dot.classList.toggle('active', i === currentGalleryIndex);
                });
            }
        };
    }

    function closeGallery() {
        document.getElementById('fullscreenGallery').classList.remove('active');
    }

    /**
     * ========================================
     * PHASE 2: ADDRESS FORM
     * ========================================
     */
    function prefillAddressForm() {
    if (!state.user?.address) return;
    
    const addr = state.user.address;
    
    // Set values if they exist
    if (document.getElementById('fullName')) document.getElementById('fullName').value = addr.fullName || '';
    if (document.getElementById('email')) document.getElementById('email').value = addr.email || '';
    if (document.getElementById('countryCode')) document.getElementById('countryCode').value = addr.phone?.countryCode || '+91';
    if (document.getElementById('phoneNumber')) document.getElementById('phoneNumber').value = addr.phone?.number || '';
    if (document.getElementById('addressLine1')) document.getElementById('addressLine1').value = addr.addressLine1 || '';
    if (document.getElementById('addressLine2')) document.getElementById('addressLine2').value = addr.addressLine2 || '';
    if (document.getElementById('city')) document.getElementById('city').value = addr.city || '';
    if (document.getElementById('state')) document.getElementById('state').value = addr.state || '';
    if (document.getElementById('postalCode')) document.getElementById('postalCode').value = addr.postalCode || '';
    if (document.getElementById('country')) document.getElementById('country').value = addr.country || 'India';
    if (document.getElementById('specialInstructions')) document.getElementById('specialInstructions').value = addr.specialInstructions || '';
} 

    function continueApplication() {
    const form = document.getElementById('addressForm');
    const requiredInputs = form.querySelectorAll('input[required], select[required]');
    let isValid = true;
    
    // Reset all errors
    form.querySelectorAll('input, textarea').forEach(el => el.classList.remove('error'));
    
    // Check required fields
    requiredInputs.forEach(input => {
        if (!input.value.trim()) {
            input.classList.add('error');
            isValid = false;
        }
    });
    
    // Email validation
    const emailInput = document.getElementById('email');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(emailInput.value.trim())) {
        emailInput.classList.add('error');
        isValid = false;
        showFieldError(emailInput, 'Please enter a valid email address');
    }
    
    // Phone validation
    const countryCodeInput = document.getElementById('countryCode');
    const phoneInput = document.getElementById('phoneNumber');
    
    if (!countryCodeInput.value.startsWith('+')) {
        countryCodeInput.classList.add('error');
        isValid = false;
        showFieldError(countryCodeInput, 'Country code must start with +');
    }
    
    if (!/^\+?\d{1,3}$/.test(countryCodeInput.value.trim())) {
        countryCodeInput.classList.add('error');
        isValid = false;
        showFieldError(countryCodeInput, 'Country code must be 1-3 digits after +');
    }
    
    const phoneRegex = /^\d{10,15}$/;
    if (!phoneRegex.test(phoneInput.value.trim().replace(/\D/g, ''))) {
        phoneInput.classList.add('error');
        isValid = false;
        showFieldError(phoneInput, 'Phone number must be 10-15 digits');
    }
    
    // Postal code validation
    const postalCodeInput = document.getElementById('postalCode');
    if (!/^\d{6,10}$/.test(postalCodeInput.value.trim())) {
        postalCodeInput.classList.add('error');
        isValid = false;
        showFieldError(postalCodeInput, 'Postal code must be 6-10 digits');
    }
    
    // Terms agreement
    const termsCheckbox = document.getElementById('termsAgreement');
    if (!termsCheckbox.checked) {
        termsCheckbox.classList.add('error');
        isValid = false;
        showFieldError(termsCheckbox, 'You must agree to the terms');
    }
    
    // Policy agreement
    const policyCheckbox = document.getElementById('policyAgreement');
    if (!policyCheckbox.checked) {
        policyCheckbox.classList.add('error');
        isValid = false;
        showFieldError(policyCheckbox, 'You must agree to the policies');
    }
    
    if (!isValid) {
        return;
    }
    
    // Save complete address data
    const address = {
        fullName: document.getElementById('fullName').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: {
            countryCode: document.getElementById('countryCode').value.trim(),
            number: document.getElementById('phoneNumber').value.trim(),
            full: document.getElementById('countryCode').value.trim() + ' ' + document.getElementById('phoneNumber').value.trim()
        },
        addressLine1: document.getElementById('addressLine1').value.trim(),
        addressLine2: document.getElementById('addressLine2').value.trim(),
        city: document.getElementById('city').value.trim(),
        state: document.getElementById('state').value.trim(),
        postalCode: document.getElementById('postalCode').value.trim(),
        country: document.getElementById('country').value.trim(),
        specialInstructions: document.getElementById('specialInstructions').value.trim()
    };
    
    // Store address for checkout flow ONLY - do NOT set state.user yet
    // state.user should only be set after actual login
    state.checkoutData.address = address;
    
    // Store temporarily for later use during account creation (but NOT as logged in user)
    state.checkoutData.tempUserData = {
        name: address.fullName,
        email: address.email,
        phone: address.phone.full,
        address: address
    };
    
    saveState();
    navigateTo('deposit');
}

function showFieldError(element, message) {
    // Remove any existing error message
    const existingError = element.parentNode.querySelector('.field-error');
    if (existingError) existingError.remove();
    
    // Create error message element
    const errorDiv = document.createElement('div');
    errorDiv.className = 'field-error text-xs text-red-500 mt-1';
    errorDiv.textContent = message;
    
    // Insert after the element
    element.parentNode.appendChild(errorDiv);
}

function validateCountryCode(input) {
    // Ensure it starts with +
    if (!input.value.startsWith('+')) {
        input.value = '+' + input.value.replace(/[^0-9]/g, '');
    }
    
    // Only allow + followed by 1-3 digits
    let value = input.value;
    if (value.length > 1) {
        value = '+' + value.substring(1).replace(/[^0-9]/g, '').substring(0, 3);
        input.value = value;
    }
}

function validatePhoneNumber(input) {
    // Remove all non-digits
    input.value = input.value.replace(/\D/g, '').substring(0, 15);
}

function validatePostalCode(input) {
    // Remove all non-digits
    input.value = input.value.replace(/\D/g, '').substring(0, 10);
}
    /**
     * ========================================
     * PHASE 3: DEPOSIT / REGISTRATION
     * ========================================
     */
    function renderDepositPage() {
        const settings = state.settings || {};
        const amount = settings.bidRegistrationFee || 100; 
        if (document.getElementById('depositAmount')) {
            document.getElementById('depositAmount').textContent = amount.toLocaleString();
        }
        // Remember which product this deposit is for
        if (state.currentProduct?.id) {
            state.checkoutData.targetProductId = state.currentProduct.id;
            saveState();
        }
    }

    function processPayment() {
        // Simulate payment processing (demo - no real payment)
        alert('Registration payment confirmed');
        // flag payment as confirmed for this session
        state.checkoutData.paymentConfirmed = true;
        // Mark deposit paid for target product (from flow) or current product
        const targetPid = state.checkoutData.targetProductId || state.currentProduct?.id;
        if (targetPid) {
            if (!state.deposits.includes(targetPid)) {
                state.deposits.push(targetPid);
            }
        }
        saveState();
        
        // If user is already logged in, go directly to place bid
        if (state.user) {
            const product = state.products.find(p => p.id === targetPid);
            if (product) {
                state.currentProduct = product;
                
                // Set up pending bid
                const identifier = state.user.identifier;
                const code = getOrCreateBidCode(product.id, identifier);
                const addressObj = state.user.address || {};
                
                state.pendingBid = {
                    code,
                    productId: product.id,
                    productName: product.name,
                    name: state.user.name || identifier,
                    email: identifier.includes('@') ? identifier : (state.user.email || ''),
                    phone: !identifier.includes('@') ? identifier : (state.user.phone || ''),
                    address: {
                        fullName: state.user.name,
                        email: identifier.includes('@') ? identifier : (state.user.email || ''),
                        addressLine1: addressObj.addressLine1 || addressObj.line1,
                        city: addressObj.city,
                        state: addressObj.state,
                        country: addressObj.country,
                        postalCode: addressObj.postalCode || addressObj.pincode
                    },
                    size: state.checkoutData.size
                };
                
                navigateTo('placeBid');
            } else {
                navigateTo('home');
            }
        } else {
            // Not logged in, go to signup flow
            navigateTo('signup');
        }
    }

    // Keep for backward compatibility
    function confirmDeposit() {
        processPayment();
    }

    async function handleSignup() {
        const identifier = document.getElementById('signupIdentifier').value.trim();
        const password = document.getElementById('signupPassword').value.trim();
        const name = state.checkoutData.tempUserData?.name || state.checkoutData.address?.fullName || '';
        const address = state.checkoutData.tempUserData?.address || state.checkoutData.address || null;

        if (!identifier || password.length < 6) {
            alert('Please enter valid details. Password min 6 chars.');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ identifier, password, name, address })
            });

            if (!res.ok) {
                const err = await res.text();
                throw new Error(err || 'Signup failed');
            }

            state.checkoutData.pendingSignup = { identifier, password };
            document.getElementById('otpDest').textContent = identifier;
            alert('OTP sent to ' + identifier);
            navigateTo('otp');
        } catch (err) {
            console.error(err);
            alert('Signup failed. Please try again.');
        }
    }

    async function handleOTP() {
        const otp = document.getElementById('otpInput').value.trim();
        const pending = state.checkoutData.pendingSignup;
        if (!pending) {
            navigateTo('signup');
            return;
        }

        if (!otp || otp.length !== 6) {
            alert('Invalid OTP. Try again.');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/verify-otp`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ identifier: pending.identifier, otp })
            });

            if (!res.ok) {
                const err = await res.text();
                throw new Error(err || 'OTP verification failed');
            }

            // Clear pending signup state
            state.checkoutData.paymentConfirmed = false;
            state.checkoutData.pendingSignup = null;
            saveState();

            alert('Account verified successfully! Please login.');
            navigateTo('userLoginPage');
        } catch (err) {
            console.error(err);
            alert('Invalid OTP. Please try again.');
        }
    }

    async function handleUserLogin() {
        const identifier = document.getElementById('loginIdentifier').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        if (!identifier || !password) {
            alert('Please enter valid credentials');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ identifier, password })
            });

            if (!res.ok) {
                const err = await res.text();
                throw new Error(err || 'Login failed');
            }

            const userData = await res.json();
            state.user = userData;
            saveState();

            // If a product target was stored during deposit flow, set currentProduct
            if (state.checkoutData.targetProductId) {
                const target = state.products.find(p => p.id === state.checkoutData.targetProductId);
                if (target) state.currentProduct = target;
            }

            // If we came from a product flow, go directly to Place Bid and set pending bid context
            if (state.currentProduct) {
                const product = state.products.find(p => p.id === state.currentProduct.id) || state.currentProduct;
                const code = getOrCreateBidCode(product.id, identifier);
                const addr = state.user.address || {};
                state.pendingBid = {
                    code,
                    productId: product.id,
                    productName: product.name,
                    name: state.user.name || identifier,
                    email: identifier.includes('@') ? (state.user.email || identifier) : '',
                    phone: !identifier.includes('@') ? (state.user.phone || identifier) : '',
                    address: addr,
                    size: state.checkoutData.size
                };
                state.currentProduct = product;
                navigateTo('placeBid');
            } else {
                navigateTo('home');
            }
            renderDynamicMenu();
        } catch (err) {
            console.error(err);
            alert('Login failed. Please try again.');
        }
    }

    async function handleLogout() {
        try {
            await fetch(`${API_BASE}/logout`, { method: 'POST', credentials: 'include' });
        } catch (e) {}
        state.user = null;
        saveState();
        renderDynamicMenu();
        alert('You have been logged out successfully');
        navigateTo('home');
    }

    function renderMyAccount() {
        const user = state.user;
        if (!user) return;
        
        // Locked identifiers
        if (user.identifier && user.identifier.includes('@')) {
            document.getElementById('accEmail').value = user.identifier;
            document.getElementById('accMobile').value = user.phone || '';
        } else if (user.identifier) {
            document.getElementById('accMobile').value = user.identifier;
            document.getElementById('accEmail').value = user.email || '';
        }
        
        // Name
        document.getElementById('accFullName').value = user.name || '';
        
        // Address (support multiple property names)
        const addr = user.address || {};
        document.getElementById('accAddress').value = addr.addressLine1 || addr.line1 || addr.address || '';
        document.getElementById('accCity').value = addr.city || '';
        document.getElementById('accState').value = addr.state || '';
        document.getElementById('accCountry').value = addr.country || 'India';
        document.getElementById('accPincode').value = addr.postalCode || addr.pincode || '';
        
        // Photo
        document.getElementById('accPhoto').value = user.photo || '';
        
        // Render applications list
        renderMyApplications(user);
    }

    function renderMyApplications(user) {
        const listContainer = document.getElementById('accountBidsList');
        if (!listContainer) return;
        
        const userIdentifier = user.identifier || '';
        const userEmail = user.email || (userIdentifier.includes('@') ? userIdentifier : '');
        const userPhone = user.phone || (!userIdentifier.includes('@') ? userIdentifier : '');
        
        const userBids = state.bids.filter(bid => {
            if (bid.userIdentifier && bid.userIdentifier === userIdentifier) return true;
            if (userEmail && (bid.email === userEmail || bid.address?.email === userEmail)) return true;
            if (userPhone && (bid.phone === userPhone || bid.address?.phone?.full === userPhone)) return true;
            if (bid.email === userIdentifier || bid.phone === userIdentifier) return true;
            if (user.name && bid.name === user.name) return true;
            return false;
        }).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        if (!userBids.length) {
            listContainer.innerHTML = `
                <div class="text-center py-8">
                    <p class="text-gray-500 mb-4">You haven't applied for any products yet.</p>
                    <button class="btn-secondary text-sm" onclick="navigateTo('home')">BROWSE PRODUCTS</button>
                </div>
            `;
            return;
        }
        
        listContainer.innerHTML = userBids.map(bid => {
            const product = state.products.find(p => p.id === bid.productId);
            const productClosed = product?.bidStatus === 'CLOSED';
            const isWinner = bid.status === 'WINNER';
            const isLost = bid.status === 'REFUNDED' || (productClosed && bid.status !== 'WINNER');
            const isPending = !productClosed && bid.status === 'ACTIVE';
            
            let statusDot = '';
            let statusText = '';
            let statusClass = '';
            
            if (isWinner) {
                statusDot = '<span class="w-3 h-3 rounded-full bg-green-500 shadow-lg shadow-green-500/50 animate-pulse"></span>';
                statusText = 'WON';
                statusClass = 'text-green-400';
            } else if (isLost) {
                statusDot = '<span class="w-3 h-3 rounded-full bg-red-500 shadow-lg shadow-red-500/50"></span>';
                statusText = 'LOST';
                statusClass = 'text-red-400';
            } else if (isPending) {
                statusDot = '<span class="w-3 h-3 rounded-full bg-yellow-500 shadow-lg shadow-yellow-500/50 animate-pulse"></span>';
                statusText = 'PENDING';
                statusClass = 'text-yellow-400';
            } else {
                statusDot = '<span class="w-3 h-3 rounded-full bg-gray-500"></span>';
                statusText = 'CLOSED';
                statusClass = 'text-gray-400';
            }
            
            // Calculate remaining amount for winner
            const deposit = state.settings?.bidRegistrationFee || 100;
            const remainingAmount = (bid.bidAmount || 0) - deposit;
            
            // Check payment deadline for winners
            let paymentDeadlineHTML = '';
            let paymentButtonHTML = '';
            
            if (isWinner && !bid.paymentCompleted) {
                const wonAt = new Date(bid.wonAt || bid.createdAt);
                const deadline = new Date(wonAt.getTime() + (24 * 60 * 60 * 1000)); // 24 hours
                const now = new Date();
                const hoursLeft = Math.max(0, Math.floor((deadline - now) / (1000 * 60 * 60)));
                const minutesLeft = Math.max(0, Math.floor(((deadline - now) % (1000 * 60 * 60)) / (1000 * 60)));
                
                if (now > deadline && !bid.paymentCompleted) {
                    // Deadline passed - show penalty warning
                    paymentDeadlineHTML = `
                        <div class="mt-3 p-2 bg-red-900/30 border border-red-800 rounded text-xs">
                            <p class="text-red-400 font-bold">‚ö†Ô∏è PAYMENT OVERDUE</p>
                            <p class="text-red-300">You are liable for 3√ó penalty (‚Çπ${(product.price * 3).toLocaleString()})</p>
                        </div>
                    `;
                } else {
                    // Show countdown and pay button
                    paymentDeadlineHTML = `
                        <div class="mt-2 text-xs text-yellow-400">
                            ‚è∞ Pay within: <span class="font-bold">${hoursLeft}h ${minutesLeft}m</span>
                        </div>
                    `;
                    paymentButtonHTML = `
                        <button class="mt-3 w-full bg-green-600 hover:bg-green-500 text-white text-xs font-bold py-2 px-4 rounded-lg transition-colors" onclick="event.stopPropagation(); openWinnerPayment(${bid.id}, ${bid.productId}, ${remainingAmount})">
                            PAY ‚Çπ${remainingAmount.toLocaleString()} NOW
                        </button>
                    `;
                }
            } else if (isWinner && bid.paymentCompleted) {
                paymentDeadlineHTML = `
                    <div class="mt-2 p-2 bg-green-900/30 border border-green-800 rounded text-xs">
                        <p class="text-green-400 font-bold">‚úì PAYMENT COMPLETED</p>
                    </div>
                `;
            }
            
            // For second-chance winners (no penalty obligation)
            let secondChanceHTML = '';
            if (bid.isSecondChance && !bid.paymentCompleted) {
                secondChanceHTML = `
                    <div class="mt-2 p-2 bg-blue-900/30 border border-blue-800 rounded text-xs">
                        <p class="text-blue-400">üéâ Second chance offer - No obligation to pay</p>
                    </div>
                `;
                paymentButtonHTML = `
                    <button class="mt-3 w-full bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold py-2 px-4 rounded-lg transition-colors" onclick="event.stopPropagation(); openWinnerPayment(${bid.id}, ${bid.productId}, ${remainingAmount})">
                        PAY ‚Çπ${remainingAmount.toLocaleString()} (OPTIONAL)
                    </button>
                `;
            }
            
            return `
                <div class="bg-[#111] p-4 flex flex-col gap-3 border border-gray-800 rounded-lg hover:border-gray-700 transition-colors ${isWinner ? 'border-green-800' : ''}" onclick="navigateTo('product', ${bid.productId})">
                    <div class="flex gap-4">
                        <img src="${product?.images?.[0] || ''}" class="w-20 h-24 object-cover flex-shrink-0 rounded" alt="${product?.name || 'Product'}">
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start gap-2 mb-2">
                                <p class="font-bold text-sm truncate text-white">${product?.name || 'Product'}</p>
                                <div class="flex items-center gap-2 flex-shrink-0">
                                    ${statusDot}
                                    <span class="text-xs font-bold ${statusClass}">${statusText}</span>
                                </div>
                            </div>
                            <p class="text-sm text-white font-semibold">‚Çπ${bid.bidAmount?.toLocaleString() || '0'}</p>
                            <p class="text-xs text-gray-500 font-mono mt-1">Code: <span class="text-gray-400">${bid.code}</span></p>
                            <div class="flex justify-between items-center mt-2">
                                <p class="text-[10px] text-gray-600">${new Date(bid.createdAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}</p>
                                ${bid.size ? `<p class="text-[10px] text-gray-500">Size: ${bid.size}</p>` : ''}
                            </div>
                        </div>
                    </div>
                    ${paymentDeadlineHTML}
                    ${secondChanceHTML}
                    ${paymentButtonHTML}
                </div>
            `;
        }).join('');
    }

    function saveAccountDetails() {
        if (!state.user) return;
        if (!state.registeredUsers) state.registeredUsers = [];

        const idx = state.registeredUsers.findIndex(u => u.identifier === state.user.identifier);
        if (idx === -1) {
            alert('User not found');
            return;
        }

        const updatedUser = { ...state.registeredUsers[idx] };

        // Name
        updatedUser.name = document.getElementById('accFullName').value.trim();

        // Address with consistent props
        const addressLine = document.getElementById('accAddress').value.trim();
        const city = document.getElementById('accCity').value.trim();
        const stateVal = document.getElementById('accState').value.trim();
        const country = document.getElementById('accCountry').value.trim();
        const pincode = document.getElementById('accPincode').value.trim();

        updatedUser.address = {
            addressLine1: addressLine,
            line1: addressLine,
            city,
            state: stateVal,
            country,
            postalCode: pincode,
            pincode,
            fullName: updatedUser.name,
            email: updatedUser.email || (updatedUser.identifier?.includes('@') ? updatedUser.identifier : ''),
            phone: updatedUser.phone || (!updatedUser.identifier?.includes('@') ? updatedUser.identifier : '')
        };

        // Photo
        updatedUser.photo = document.getElementById('accPhoto').value.trim();

        // Password (optional)
        const newPass = document.getElementById('accNewPassword').value.trim();
        if (newPass && newPass.length < 6) {
            alert('Password must be at least 6 characters');
            return;
        }
        if (newPass) updatedUser.password = newPass;

        // Persist
        state.registeredUsers[idx] = updatedUser;
        state.user = updatedUser;
        state.checkoutData.address = updatedUser.address;
        saveState();

        alert('Account details updated successfully');
        renderMyAccount();
    }

    /**
     * ========================================
     * PHASE 4: BIDDING LOGIC
     * ========================================
     */
    function getOrCreateBidCode(productId, email) {
        const key = `${productId}_${email}`;
        
        if (bidCodeStore[key]) {
            return bidCodeStore[key];
        }
        
        // Generate 6-digit code
        const code = Math.floor(100000 + Math.random() * 900000).toString();
        bidCodeStore[key] = code;
        
        try {
            localStorage.setItem('bidCodes', JSON.stringify(bidCodeStore));
        } catch (e) {}
        
        return code;
    }

    function getMinimumBid(productId) {
        const product = state.products.find(p => p.id === productId);
        if (!product) return 0;
        
        // Get all bids for this product
        const productBids = state.bids.filter(b => 
            b.productId === productId && 
            b.status !== 'REFUNDED' && 
            b.bidAmount > 0
        );
        
        const increment = state.settings?.bidIncrement || 100;
        
        if (productBids.length === 0) {
            // First bid: must be >= product price
            return product.price;
        }
        
        // Subsequent bids: must be >= highest bid + increment (‚Çπ100)
        const highestBid = Math.max(...productBids.map(b => b.bidAmount));
        return highestBid + increment;
    }

    function renderPlaceBidPage() {
        const product = state.currentProduct;
        let pending = state.pendingBid;
        
        // If no pending bid, check if user has existing bid
        if (!pending && state.user?.email) {
            const existingBid = state.bids.find(b => 
                b.productId === product?.id && b.email === state.user.email
            );
            
            if (existingBid) {
                pending = {
                    code: existingBid.code,
                    productId: existingBid.productId,
                    name: existingBid.name,
                    email: existingBid.email,
                    existingBidId: existingBid.id
                };
                state.pendingBid = pending;
            }
        }
        
        if (!product || !pending) {
            navigateTo('home');
            return;
        }
        
        // Show code
        document.getElementById('yourBidCode').textContent = pending.code;
        
        // Calculate minimum bid
        const minBid = getMinimumBid(product.id);
        document.getElementById('minimumBidAmount').textContent = minBid.toLocaleString();
        
        // Set up input
        const input = document.getElementById('bidAmountInput');
        input.min = minBid;
        input.placeholder = minBid.toLocaleString();
        input.value = '';
        
        // Store minimum for validation
        state.pendingBid.minimumBid = minBid;
    }

    function goToPlaceBid() {
        const product = state.currentProduct;
        
        if (!product) return;
        
        // Track target product so flow continues after login
        state.checkoutData.targetProductId = product.id;
        saveState();
        
        // Enforce per-product deposit: if not paid, send to address/deposit flow
        if (!state.deposits.includes(product.id)) {
            navigateTo('address');
            return;
        }
        
        if (!state.user) {
            navigateTo('userLoginPage');
            return;
        }
        
        const identifier = state.user.identifier;
        const code = getOrCreateBidCode(product.id, identifier);
        
        const addressObj = state.user.address || {};
        
        state.pendingBid = {
            code,
            productId: product.id,
            productName: product.name,
            name: state.user.name || identifier,
            email: identifier.includes('@') ? identifier : (state.user.email || ''),
            phone: !identifier.includes('@') ? identifier : (state.user.phone || ''),
            address: {
                fullName: state.user.name,
                email: identifier.includes('@') ? identifier : (state.user.email || ''),
                addressLine1: addressObj.line1,
                city: addressObj.city,
                state: addressObj.state,
                country: addressObj.country,
                postalCode: addressObj.pincode
            },
            size: state.checkoutData.size
        };
        
        navigateTo('placeBid');
    }

 async function submitBid() {
    const product = state.currentProduct;
    const pending = state.pendingBid;
    
    if (!product || !pending) {
        alert('Session expired.');
        navigateTo('home');
        return;
    }
    
    const input = document.getElementById('bidAmountInput');
    const bidAmount = parseInt(input.value || '0', 10);
    const minBid = pending.minimumBid || product.price;
    
    // Validate
    if (!bidAmount || bidAmount < minBid) {
        input.classList.add('error');
        setTimeout(() => input.classList.remove('error'), 800);
        alert(`Your bid must be at least ‚Çπ${minBid.toLocaleString()}`);
        return;
    }
    
    // Check if editing existing bid
    const existingBid = state.bids.find(b => 
        b.productId === product.id && b.code === pending.code
    );
    
    if (existingBid) {
        // Check edit chance
        if (existingBid.edited) {
            alert('You have already used your edit chance for this bid.');
            return;
        }
        
        // Update existing bid
        existingBid.bidAmount = bidAmount;
        existingBid.edited = true;
        existingBid.editedAt = new Date().toISOString();
        
        // Sync to backend
        await syncBidUpdate(existingBid);
        
        state.lastConfirmedBid = {
            code: existingBid.code,
            productId: product.id,
            productName: product.name,
            bidAmount,
            canEdit: false
        };
    } else {
        // Create new bid
        const newBid = {
            id: Date.now(),
            productId: product.id,
            productName: product.name,
            name: pending.name || state.user?.name,
            email: pending.email || state.user?.email,
            phone: pending.phone || state.user?.phone,
            address: pending.address || state.user?.address,
            country: pending.country || state.user?.address?.country,
            deposit: pending.deposit,
            bidAmount,
            code: pending.code,
            size: pending.size,
            status: 'ACTIVE',
            userIdentifier: state.user?.identifier,
            edited: false,
            createdAt: new Date().toISOString()
        };
        
        state.bids.push(newBid);
        
        // Sync to backend
        await syncBid(newBid);
        
        state.lastConfirmedBid = {
            code: pending.code,
            productId: product.id,
            productName: product.name,
            bidAmount,
            canEdit: true
        };
    }
    
    state.pendingBid = null;
    state.checkoutData = { paymentMethod: 'upi' };
    saveState();
    
    navigateTo('confirmed');
}
    /**
     * ========================================
     * PHASE 5: POST-BID CONFIRMATION
     * ========================================
     */
    function renderConfirmedPage() {
        const content = document.getElementById('confirmedContent');
        const last = state.lastConfirmedBid;
        
        if (last) {
            content.innerHTML = `
                <div class="w-24 h-24 rounded-full border border-green-500/50 flex items-center justify-center mb-8">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                </div>
                
                <h1 class="text-3xl font-bold tracking-brutal mb-4">Bid Placed!</h1>
                <p class="text-muted text-center mb-8">Your bid has been successfully registered</p>
                
                <div class="border border-gray-800 p-6 mb-6 w-full max-w-xs">
                    <p class="text-sm text-muted mb-2 tracking-widest">YOUR UNIQUE CODE</p>
                    <p class="bid-code-display">${last.code}</p>
                </div>
                
                <div class="border border-gray-800 p-4 mb-8 w-full max-w-xs">
                    <p class="text-sm text-muted mb-1">Your Bid Amount</p>
                    <p class="text-2xl font-bold">‚Çπ${last.bidAmount.toLocaleString()}</p>
                </div>
                
                <p class="text-gray-500 text-center text-sm leading-relaxed mb-8 max-w-xs">
                    Keep this code safe. You'll need it to verify your bid status and claim your item if you win.
                </p>
                
                ${last.canEdit ? `
                    <button class="btn-primary w-full max-w-xs mb-4" onclick="editBid()">EDIT BID</button>
                    <p class="text-xs text-gray-600 mb-4">You have 1 edit chance remaining</p>
                ` : `
                    <p class="text-xs text-gray-600 mb-4">Edit chance used</p>
                `}
                
                <button class="btn-secondary w-full max-w-xs" onclick="navigateTo('home')">CONTINUE SHOPPING</button>
            `;
        } else {
            content.innerHTML = `
                <div class="w-24 h-24 rounded-full border border-gray-700 flex items-center justify-center mb-8">
                    <span class="text-4xl">‚ù§Ô∏è</span>
                </div>
                
                <h1 class="text-3xl font-bold tracking-brutal mb-4">Thank You</h1>
                <p class="text-muted text-center mb-12">For choosing WEARENFEEL</p>
                
                <button class="btn-primary w-full max-w-xs" onclick="navigateTo('home')">CONTINUE SHOPPING</button>
            `;
        }
    }

    function editBid() {
        const last = state.lastConfirmedBid;
        if (!last || !last.canEdit) {
            alert('Edit is not available.');
            return;
        }
        
        const bid = state.bids.find(b => 
            b.productId === last.productId && b.code === last.code
        );
        
        if (!bid || bid.edited) {
            alert('You have already used your edit chance.');
            return;
        }
        
        const product = state.products.find(p => p.id === last.productId);
        if (!product) {
            alert('Product not found.');
            return;
        }
        
        state.currentProduct = product;
        state.pendingBid = {
            code: bid.code,
            productId: product.id,
            productName: product.name,
            name: bid.name,
            email: bid.email,
            minimumBid: getMinimumBid(product.id)
        };
        state.lastConfirmedBid = null;
        
        navigateTo('placeBid');
    }

    /**
     * ========================================
     * PHASE 6: MY BIDS PAGE
     * ========================================
     */
    function renderMyBids() {
        const list = document.getElementById('myBidsList');
        
        if (!state.user?.email) {
            list.innerHTML = `
                <div class="text-center py-12">
                    <p class="text-gray-500 mb-4">Sign in to see your bids</p>
                    <button class="btn-secondary" onclick="navigateTo('home')">Browse Products</button>
                </div>
            `;
            return;
        }
        
        const userBids = state.bids
            .filter(b => b.email === state.user.email)
            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        if (!userBids.length) {
            list.innerHTML = `
                <div class="text-center py-12">
                    <p class="text-gray-500 mb-4">You haven't placed any bids yet</p>
                    <button class="btn-secondary" onclick="navigateTo('home')">Browse Products</button>
                </div>
            `;
            return;
        }
        
        list.innerHTML = userBids.map(bid => {
            const product = state.products.find(p => p.id === bid.productId);
            const isClosed = bid.status === 'WINNER' || bid.status === 'REFUNDED' || product?.bidStatus === 'CLOSED';
            const canEdit = bid.status === 'ACTIVE' && !bid.edited;
            
            let resultHTML = '';
            if (bid.status === 'WINNER') {
                resultHTML = '<span class="bid-status won">WON</span>';
            } else if (bid.status === 'REFUNDED' || (isClosed && bid.status !== 'WINNER')) {
                resultHTML = '<span class="bid-status lost">LOST</span>';
            }
            
            return `
                <div class="bg-[#111] p-4 flex gap-4">
                    <img src="${product?.images?.[0] || ''}" class="w-20 h-24 object-cover flex-shrink-0" alt="">
                    <div class="flex-1 min-w-0">
                        <p class="font-bold truncate">${product?.name || 'Product'}</p>
                        <p class="text-xs text-gray-500 mb-2">${new Date(bid.createdAt).toLocaleDateString()}</p>
                        
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bid-status ${isClosed ? 'closed' : 'active'}">${isClosed ? 'CLOSED' : 'ACTIVE'}</span>
                            ${resultHTML}
                        </div>
                        
                        <p class="text-sm text-gray-400">Bid: <span class="text-white font-bold">‚Çπ${bid.bidAmount.toLocaleString()}</span></p>
                        <p class="text-sm text-gray-400">Code: <span class="accent font-mono">${bid.code}</span></p>
                        
                        ${canEdit ? `
                            <button class="btn-secondary text-xs mt-3 py-2 px-4" onclick="editBidFromList('${bid.code}', ${bid.productId})">
                                EDIT BID
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }).join('');
    }

    function editBidFromList(code, productId) {
        const bid = state.bids.find(b => b.code === code && b.productId === productId);
        if (!bid || bid.edited) {
            alert('Edit chance already used.');
            return;
        }
        
        const product = state.products.find(p => p.id === productId);
        if (!product) return;
        
        state.currentProduct = product;
        state.pendingBid = {
            code: bid.code,
            productId: product.id,
            productName: product.name,
            name: bid.name,
            email: bid.email,
            minimumBid: getMinimumBid(product.id)
        };
        
        navigateTo('placeBid');
    }

    /**
     * ========================================
     * PHASE 7: ADMIN AUTHENTICATION
     * ========================================
     */
    function adminLogin() {
        const email = document.getElementById('adminEmail').value.trim();
        const password = document.getElementById('adminPassword').value;
        
        // Demo: Accept any non-empty credentials
        // In production, this would validate against a backend
        if (email && password) {
            state.isAdmin = true;
            saveState();
            updateAdminUI();
            navigateTo('admin');
        } else {
            alert('Please enter email and password');
        }
    }

    function logoutAdmin() {
        state.isAdmin = false;
        saveState();
        updateAdminUI();
        toggleMenu();
        navigateTo('home');
    }

    /**
     * ========================================
     * PHASE 8: ADMIN DASHBOARD
     * ========================================
     */
function checkAuctionEndTimes() {
    const now = new Date();
    let updated = false;
    
    state.products.forEach(product => {
        if (product.auctionEnd && product.bidStatus === 'OPEN') {
            const endTime = new Date(product.auctionEnd);
            if (now >= endTime) {
                product.bidStatus = 'CLOSED';
                updated = true;
            }
        }
    });
    
    if (updated) saveState();
}

function renderAdminDashboard() {
    checkAuctionEndTimes();
    
    // Calculate stats
    const productsAvailable = state.products.filter(p => p.stock > 0).length;
    const totalBids = state.bids.length;
    const activeBids = state.bids.filter(b => b.status === 'ACTIVE').length;
    const closedBids = state.bids.filter(b => b.status === 'WINNER' || b.status === 'REFUNDED').length;
    const visitors = getVisitorCount();
    const customers = new Set(state.bids.map(b => b.email)).size;
    
    // Update stats
    document.getElementById('statProducts').textContent = productsAvailable;
    document.getElementById('statTotalBids').textContent = totalBids;
    document.getElementById('statActiveBids').textContent = activeBids;
    document.getElementById('statClosedBids').textContent = closedBids;
    document.getElementById('statVisitors').textContent = visitors;
    document.getElementById('statCustomers').textContent = customers;
    
    // Recent activity
    const activities = state.bids
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .slice(0, 8)
        .map(bid => {
            const product = state.products.find(p => p.id === bid.productId);
            const timeAgo = getTimeAgo(new Date(bid.createdAt));
            
            return `
                <div class="flex items-center gap-3 p-3 bg-gray-900/50 rounded">
                    <div class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center">
                        <span class="text-xs">${bid.code.substring(0, 2)}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm truncate">New bid on <strong>${product?.name || 'Product'}</strong></p>
                        <p class="text-xs text-gray-500">‚Çπ${bid.bidAmount?.toLocaleString() || '0'} ‚Ä¢ ${timeAgo}</p>
                    </div>
                </div>
            `;
        }).join('');
    
    document.getElementById('recentActivity').innerHTML = activities || 
        '<p class="text-gray-500 text-center py-4">No recent activity</p>';
    
    // Update settings field
    const feeInput = document.getElementById('settingsBidFee');
    if (feeInput) {
        feeInput.value = state.settings?.bidRegistrationFee || 5000;
    }
}

function getTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    return `${diffDays}d ago`;
}

/**
 * ========================================
 * PHASE 9: PRODUCT MANAGEMENT
 * ========================================
 */
function showAddProduct(productId = null) {
    const modal = document.getElementById('productModal');
    const title = document.getElementById('productModalTitle');
    const form = document.getElementById('productForm');
    
    if (productId) {
        // Edit mode
        const product = state.products.find(p => p.id === productId);
        if (!product) return;
        
        title.textContent = 'Edit Product';
        document.getElementById('productId').value = product.id;
        document.getElementById('productName').value = product.name;
        document.getElementById('productPrice').value = product.price;
        document.getElementById('productDesc').value = product.description || '';
        document.getElementById('productSizes').value = product.sizes?.join(', ') || '';
        document.getElementById('productStock').value = product.stock || 1;
        document.getElementById('productIsAuction').checked = product.isAuction || false;
        document.getElementById('productBidDeposit').value = product.bidDeposit || 5000;
        document.getElementById('productBidStatus').value = product.bidStatus || 'OPEN';
        document.getElementById('productAuctionEnd').value = product.auctionEnd ? 
            new Date(product.auctionEnd).toISOString().slice(0, 16) : '';
        document.getElementById('productImageUrls').value = product.images?.join('\n') || '';
        document.getElementById('productVideoUrl').value = product.videoUrl || '';
        
        // Preview images
        tempImages = product.images || [];
        renderImagePreview();
    } else {
        // Add mode
        title.textContent = 'Add Product';
        form.reset();
        document.getElementById('productId').value = '';
        document.getElementById('productBidDeposit').value = 5000;
        document.getElementById('productBidStatus').value = 'OPEN';
        document.getElementById('productIsAuction').checked = true;
        tempImages = [];
        renderImagePreview();
    }
    
    modal.classList.remove('opacity-0', 'invisible');
}

function closeProductModal() {
    document.getElementById('productModal').classList.add('opacity-0', 'invisible');
}

function previewImages(event) {
    const files = Array.from(event.target.files);
    
    files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
            tempImages.push(e.target.result);
            renderImagePreview();
        };
        reader.readAsDataURL(file);
    });
}

function addImagesFromUrls() {
    const urls = document.getElementById('productImageUrls').value
        .split('\n')
        .map(url => url.trim())
        .filter(url => url);
    
    tempImages.push(...urls);
    renderImagePreview();
    document.getElementById('productImageUrls').value = '';
}

function renderImagePreview() {
    const container = document.getElementById('imagePreview');
    
    if (!tempImages.length) {
        container.innerHTML = '<div class="col-span-4 text-center text-gray-500 py-4">No images</div>';
        return;
    }
    
    container.innerHTML = tempImages.map((img, index) => `
        <div class="relative group">
            <img src="${img}" class="w-full h-24 object-cover rounded" alt="Preview ${index + 1}">
            <button type="button" onclick="removeImage(${index})" 
                    class="absolute top-1 right-1 w-6 h-6 bg-black/80 rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                √ó
            </button>
        </div>
    `).join('');
}

function removeImage(index) {
    tempImages.splice(index, 1);
    renderImagePreview();
}

async function saveProduct() {
    const form = document.getElementById('productForm');
    const id = document.getElementById('productId').value;
    const name = document.getElementById('productName').value.trim();
    const price = parseInt(document.getElementById('productPrice').value, 10);
    const description = document.getElementById('productDesc').value.trim();
    const sizesInput = document.getElementById('productSizes').value.trim();
    const stock = parseInt(document.getElementById('productStock').value, 10);
    const isAuction = document.getElementById('productIsAuction').checked;
    const bidDeposit = parseInt(document.getElementById('productBidDeposit').value, 10);
    const bidStatus = document.getElementById('productBidStatus').value;
    const auctionEnd = document.getElementById('productAuctionEnd').value;
    const videoUrl = document.getElementById('productVideoUrl').value.trim();
    
    if (!name || !price || stock === undefined) {
        alert('Please fill in all required fields');
        return;
    }
    
    const sizes = sizesInput ? sizesInput.split(',').map(s => s.trim()) : [];
    
    if (id) {
        // Update existing product
        const index = state.products.findIndex(p => p.id === parseInt(id, 10));
        if (index !== -1) {
            const updatedProduct = {
                ...state.products[index],
                name,
                price,
                description,
                sizes,
                stock,
                isAuction,
                bidDeposit,
                bidStatus,
                auctionEnd: auctionEnd || null,
                videoUrl: videoUrl || null,
                images: tempImages.length ? tempImages : state.products[index].images
            };
            state.products[index] = updatedProduct;
            
            // Sync to backend
            await syncProduct(updatedProduct, true);
        }
    } else {
        // Add new product
        const newProduct = {
            id: Date.now(),
            name,
            price,
            description,
            sizes,
            stock,
            images: tempImages.length ? tempImages : ['https://images.unsplash.com/photo-1551488831-00ddcb6c6bd3?w=600&h=800&fit=crop'],
            isAuction,
            bidDeposit,
            bidStatus,
            auctionEnd: auctionEnd || null,
            videoUrl: videoUrl || null
        };
        
        state.products.push(newProduct);
        state.cardHeights[newProduct.id] = 260 + Math.floor(Math.random() * 100);
        
        // Sync to backend
        await syncProduct(newProduct, false);
    }
    
    saveState();
    closeProductModal();
    renderAdminProducts();
    renderHome();
    alert('Product saved successfully!');
}

function renderAdminProducts() {
    const container = document.getElementById('adminProductList');
    
    container.innerHTML = state.products.map(product => `
        <div class="bg-[#0f0f0f] p-4 rounded-xl border border-gray-800/50">
            <div class="flex gap-4 mb-4">
                <img src="${product.images?.[0] || ''}" class="w-20 h-24 object-cover flex-shrink-0 rounded-lg" alt="${product.name}">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-2 flex-wrap">
                        <p class="font-bold text-base">${product.name}</p>
                        <span class="text-[10px] px-2 py-1 rounded-full font-semibold ${product.bidStatus === 'OPEN' ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 'bg-gray-500/20 text-gray-400 border border-gray-500/30'}">
                            ${product.bidStatus}
                        </span>
                    </div>
                    <p class="text-sm text-gray-500 line-clamp-2 mb-3">${product.description || 'No description'}</p>
                    <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs text-gray-400">
                        <span>‚Çπ${product.price.toLocaleString()}</span>
                        <span>Stock: ${product.stock}</span>
                        <span>Deposit: ‚Çπ${(product.bidDeposit || 5000).toLocaleString()}</span>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 pt-3 border-t border-gray-800/50">
                <button class="flex-1 bg-transparent border border-gray-700 text-white text-xs font-semibold tracking-wide py-3 px-4 rounded-lg hover:border-white hover:bg-white/5 transition-all" onclick="showAddProduct(${product.id})">
                    EDIT
                </button>
                <button class="flex-1 ${product.bidStatus === 'OPEN' ? 'bg-red-900/30 border-red-800/50 text-red-400 hover:bg-red-900/50' : 'bg-green-900/30 border-green-800/50 text-green-400 hover:bg-green-900/50'} border text-xs font-semibold tracking-wide py-3 px-4 rounded-lg transition-all" onclick="toggleProductStatus(${product.id})">
                    ${product.bidStatus === 'OPEN' ? 'CLOSE BID' : 'OPEN BID'}
                </button>
            </div>
        </div>
    `).join('');
}

async function toggleProductStatus(productId) {
    const product = state.products.find(p => p.id === productId);
    if (!product) return;
    
    product.bidStatus = product.bidStatus === 'OPEN' ? 'CLOSED' : 'OPEN';
    
    // Sync to backend
    await syncProduct(product, true);
    
    saveState();
    renderAdminProducts();
    renderAdminDashboard();
}

/**
 * ========================================
 * PHASE 10: ORDERS MANAGEMENT
 * ========================================
 */
function renderAdminOrders() {
    const container = document.getElementById('adminOrderList');
    
    // Get products with closed bids
    const closedProducts = state.products.filter(p => p.bidStatus === 'CLOSED');
    
    if (!closedProducts.length) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">No closed auctions yet</p>';
        return;
    }
    
    container.innerHTML = closedProducts.map(product => {
        const bids = state.bids.filter(b => b.productId === product.id);
        const winner = bids.find(b => b.status === 'WINNER');
        
        return `
            <div class="bg-gray-900/50 p-4" data-product-id="${product.id}">
                <div class="flex items-center gap-3 mb-3">
                    <input type="checkbox" class="order-checkbox hidden" id="order-${product.id}" onchange="updatePrintSelection()">
                    <label for="order-${product.id}" class="checkbox-custom"></label>
                    
                    <img src="${product.images?.[0] || ''}" class="w-12 h-16 object-cover" alt="${product.name}">
                    
                    <div class="flex-1 min-w-0">
                        <p class="font-bold truncate">${product.name}</p>
                        <p class="text-sm text-gray-400">Winner: ${winner ? `${winner.code} - ‚Çπ${winner.bidAmount.toLocaleString()}` : 'No winner selected'}</p>
                    </div>
                    
                    <button class="bg-transparent border border-gray-600 text-white text-[11px] font-semibold tracking-wide py-2.5 px-4 rounded-lg hover:border-white hover:bg-white/5 transition-all whitespace-nowrap" onclick="selectWinner(${product.id})">
                        ${winner ? 'CHANGE' : 'SELECT WINNER'}
                    </button>
                </div>
                
                ${winner ? `
                    <div class="bg-black/30 p-3 text-sm">
                        <p class="font-semibold">Shipping Address:</p>
                        <p class="text-gray-400">${winner.name || 'N/A'}</p>
                        <p class="text-gray-400">${winner.country || 'N/A'}</p>
                        <p class="text-gray-400">${winner.email || 'N/A'}</p>
                        <p class="text-gray-400">Size: ${winner.size || 'N/A'}</p>
                        
                        <div class="mt-3 pt-3 border-t border-gray-700">
                            ${winner.paymentCompleted ? `
                                <p class="text-green-400 font-semibold">‚úì Payment Completed</p>
                                <p class="text-xs text-gray-500">${new Date(winner.paymentCompletedAt).toLocaleString()}</p>
                            ` : `
                                <p class="text-yellow-400 font-semibold">‚è≥ Awaiting Payment</p>
                                ${winner.isSecondChance ? `
                                    <p class="text-xs text-blue-400 mt-1">Second-chance winner (no penalty obligation)</p>
                                ` : `
                                    <button class="mt-2 bg-red-900/50 border border-red-800 text-red-400 text-xs font-semibold py-2 px-3 rounded-lg hover:bg-red-900 transition-colors" onclick="assignToSecondHighest(${product.id})">
                                        WINNER DEFAULTED ‚Üí ASSIGN TO 2ND
                                    </button>
                                `}
                            `}
                        </div>
                    </div>
                ` : ''}
            </div>
        `;
    }).join('');
}

function selectWinner(productId) {
    const bids = state.bids.filter(b => b.productId === productId && b.status === 'ACTIVE');
    
    if (!bids.length) {
        alert('No active bids for this product');
        return;
    }
    
    // Show winner selection modal
    const product = state.products.find(p => p.id === productId);
    let modalHTML = `
        <div class="fixed inset-0 bg-black/95 z-100 flex items-center justify-center p-6">
            <div class="bg-gray-900 w-full max-w-md rounded-lg overflow-hidden">
                <div class="p-6 border-b border-gray-800">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold">Select Winner: ${product?.name}</h2>
                        <button onclick="closeWinnerModal()" class="w-8 h-8 flex items-center justify-center text-xl">√ó</button>
                    </div>
                </div>
                
                <div class="max-h-96 overflow-y-auto p-6">
                    <p class="text-sm text-gray-400 mb-4">Select the winning bid:</p>
                    ${bids.sort((a, b) => b.bidAmount - a.bidAmount).map(bid => `
                        <div class="bg-gray-800/50 p-4 mb-2 rounded flex items-center justify-between">
                            <div>
                                <p class="font-bold">${bid.code}</p>
                                <p class="text-sm text-gray-400">Bid: ‚Çπ${bid.bidAmount.toLocaleString()}</p>
                                <p class="text-xs text-gray-500">${bid.name || 'Anonymous'}</p>
                            </div>
                            <button class="btn-primary text-xs px-4 py-2" onclick="confirmWinner(${productId}, '${bid.code}')">
                                SELECT
                            </button>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;
    
    const modal = document.createElement('div');
    modal.id = 'winnerModal';
    modal.innerHTML = modalHTML;
    document.body.appendChild(modal);
}

function closeWinnerModal() {
    const modal = document.getElementById('winnerModal');
    if (modal) modal.remove();
}

async function confirmWinner(productId, code) {
    // Reset previous winners for this product
    state.bids.forEach(bid => {
        if (bid.productId === productId && bid.status === 'WINNER') {
            bid.status = 'REFUNDED';
        }
    });
    
    // Set new winner
    const winner = state.bids.find(b => b.productId === productId && b.code === code);
    if (winner) {
        winner.status = 'WINNER';
        winner.wonAt = new Date().toISOString();
        
        // Sync to backend
        await syncBidUpdate(winner);
        
        // Create order
        const order = {
            id: Date.now(),
            productId,
            bidId: winner.id,
            code: winner.code,
            name: winner.name,
            email: winner.email,
            country: winner.country,
            size: winner.size,
            bidAmount: winner.bidAmount,
            deposit: winner.deposit,
            status: 'PROCESSING',
            createdAt: new Date().toISOString()
        };
        
        state.orders.push(order);
        
        // Sync order to backend
        await syncOrder(order);
        
    
        
        saveState();
        renderAdminOrders();
        closeWinnerModal();
        alert('Winner selected successfully!');
    }
}

function selectAllOrders() {
    document.querySelectorAll('.order-checkbox').forEach(checkbox => {
        checkbox.checked = true;
        const label = checkbox.nextElementSibling;
        if (label && label.classList.contains('checkbox-custom')) {
            label.classList.add('checked');
        }
    });
}

function deselectAllOrders() {
    document.querySelectorAll('.order-checkbox').forEach(checkbox => {
        checkbox.checked = false;
        const label = checkbox.nextElementSibling;
        if (label && label.classList.contains('checkbox-custom')) {
            label.classList.remove('checked');
        }
    });
}

function updatePrintSelection() {
    document.querySelectorAll('.order-checkbox').forEach(checkbox => {
        const label = checkbox.nextElementSibling;
        if (label && label.classList.contains('checkbox-custom')) {
            label.classList.toggle('checked', checkbox.checked);
        }
    });
}

function printSelectedLabels() {
    const selected = Array.from(document.querySelectorAll('.order-checkbox:checked'))
        .map(checkbox => checkbox.closest('[data-product-id]'))
        .filter(el => el)
        .map(el => parseInt(el.dataset.productId, 10));
    
    if (!selected.length) {
        alert('Please select at least one order to print');
        return;
    }
    
    const printContainer = document.getElementById('printContainer');
    const ordersToPrint = state.orders.filter(order => selected.includes(order.productId));
    
    let printHTML = `
        <div class="print-labels-container">
            <h2 class="text-2xl font-bold mb-8 text-center">Shipping Labels</h2>
    `;
    
    ordersToPrint.forEach(order => {
        const product = state.products.find(p => p.id === order.productId);
        const bid = state.bids.find(b => b.code === order.code);
        
        printHTML += `
            <div class="print-label">
                <h3>WEARENFEEL</h3>
                <div class="recipient-name">${order.name || 'Customer'}</div>
                <div class="address-text">
                    <p>${order.country || 'India'}</p>
                    <p>Email: ${order.email || 'N/A'}</p>
                    <p class="phone">Contact: +91 XXXXXXXXXX</p>
                </div>
                <div class="product-info">
                    <p><strong>Product:</strong> ${product?.name || 'Unknown Product'}</p>
                    <p><strong>Size:</strong> ${order.size || 'N/A'}</p>
                    <p><strong>Order Code:</strong> ${order.code}</p>
                    <p><strong>Amount:</strong> ‚Çπ${order.bidAmount?.toLocaleString() || '0'}</p>
                </div>
            </div>
        `;
    });
    
    printHTML += '</div>';
    printContainer.innerHTML = printHTML;
    
    // Trigger print
    setTimeout(() => {
        window.print();
    }, 100);
}

/**
 * ========================================
 * PHASE 11: CUSTOMER, BIDS & APPLIED TABS
 * ========================================
 */
function renderAdminCustomers() {
    // Group bids by customer email
    const customers = {};
    state.bids.forEach(bid => {
        if (!customers[bid.email]) {
            customers[bid.email] = {
                name: bid.name,
                email: bid.email,
                country: bid.country,
                bids: [],
                totalSpent: 0
            };
        }
        customers[bid.email].bids.push(bid);
        if (bid.bidAmount) customers[bid.email].totalSpent += bid.bidAmount;
    });
    
    const customerCount = Object.keys(customers).length;
    document.getElementById('customerCount').textContent = `${customerCount} customer${customerCount !== 1 ? 's' : ''}`;
    
    const container = document.getElementById('adminCustomerList');
    
    if (!customerCount) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">No customers yet</p>';
        return;
    }
    
    container.innerHTML = Object.values(customers).map(customer => `
        <div class="bg-gray-900/50 p-4 cursor-pointer hover:bg-gray-800/50 transition-colors" 
             onclick="showCustomerDetail('${customer.email}')">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-bold">${customer.name || 'Unknown'}</p>
                    <p class="text-sm text-gray-400">${customer.email}</p>
                </div>
                <div class="text-right">
                    <p class="text-sm">${customer.bids.length} bid${customer.bids.length !== 1 ? 's' : ''}</p>
                    <p class="text-xs text-gray-500">‚Çπ${customer.totalSpent.toLocaleString()}</p>
                </div>
            </div>
        </div>
    `).join('');
}

function showCustomerDetail(email) {
    const customer = {
        name: null,
        email: null,
        phone: null,
        country: null,
        address: null,
        bids: []
    };
    
    // Collect customer data from all their bids
    state.bids.forEach(bid => {
        if (bid.email === email) {
            // Prefer the most complete data
            if (!customer.name && bid.name) customer.name = bid.name;
            if (!customer.email) customer.email = bid.email;
            if (!customer.country && bid.country) customer.country = bid.country;
            if (!customer.phone && bid.phone) customer.phone = bid.phone;
            
            // Get address - prefer the most complete one
            if (bid.address && !customer.address) {
                customer.address = bid.address;
            } else if (bid.address && customer.address) {
                // Merge address data, prefer non-null values
                customer.address = {
                    fullName: customer.address.fullName || bid.address.fullName || customer.name,
                    email: customer.address.email || bid.address.email || customer.email,
                    phone: customer.address.phone || bid.address.phone,
                    addressLine1: customer.address.addressLine1 || bid.address.addressLine1 || customer.address.line1 || bid.address.line1,
                    addressLine2: customer.address.addressLine2 || bid.address.addressLine2,
                    city: customer.address.city || bid.address.city,
                    state: customer.address.state || bid.address.state,
                    postalCode: customer.address.postalCode || bid.address.postalCode || customer.address.pincode || bid.address.pincode,
                    country: customer.address.country || bid.address.country,
                    specialInstructions: customer.address.specialInstructions || bid.address.specialInstructions
                };
            }
            
            customer.bids.push(bid);
        }
    });
    
    // Also check registeredUsers for more complete address data
    const registeredUser = state.registeredUsers?.find(u => 
        u.email === email || u.identifier === email
    );
    
    if (registeredUser) {
        if (!customer.name && registeredUser.name) customer.name = registeredUser.name;
        if (!customer.phone && registeredUser.phone) customer.phone = registeredUser.phone;
        
        if (registeredUser.address && !customer.address) {
            customer.address = registeredUser.address;
        } else if (registeredUser.address && customer.address) {
            // Merge with registered user's address
            customer.address = {
                fullName: customer.address.fullName || registeredUser.address.fullName || registeredUser.name,
                email: customer.address.email || registeredUser.address.email || registeredUser.email,
                phone: customer.address.phone || registeredUser.address.phone || registeredUser.phone,
                addressLine1: customer.address.addressLine1 || registeredUser.address.addressLine1 || registeredUser.address.line1,
                addressLine2: customer.address.addressLine2 || registeredUser.address.addressLine2,
                city: customer.address.city || registeredUser.address.city,
                state: customer.address.state || registeredUser.address.state,
                postalCode: customer.address.postalCode || registeredUser.address.postalCode || registeredUser.address.pincode,
                country: customer.address.country || registeredUser.address.country,
                specialInstructions: customer.address.specialInstructions || registeredUser.address.specialInstructions
            };
        }
    }
    
    const detailContainer = document.getElementById('adminCustomerDetail');
    const listContainer = document.getElementById('adminCustomerList');
    
    listContainer.classList.add('hidden');
    detailContainer.classList.remove('hidden');
    
    // Sort bids by date (newest first)
    customer.bids.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    // Build address HTML with null checks
    let addressHtml = '<p class="text-gray-500 italic">No address details available</p>';
    const addr = customer.address;
    
    if (addr) {
        const addressLine1 = addr.addressLine1 || addr.line1 || addr.address || '';
        const addressLine2 = addr.addressLine2 || '';
        const city = addr.city || '';
        const stateVal = addr.state || '';
        const postalCode = addr.postalCode || addr.pincode || '';
        const country = addr.country || '';
        const phoneDisplay = addr.phone?.full || addr.phone || customer.phone || '';
        const specialInstructions = addr.specialInstructions || '';
        
        // Only show address section if we have at least some data
        if (addressLine1 || city || stateVal || country) {
            addressHtml = `
                <div class="space-y-2 text-gray-300">
                    <p class="font-semibold text-white">${addr.fullName || customer.name || 'Customer'}</p>
                    ${addressLine1 ? `<p>${addressLine1}</p>` : ''}
                    ${addressLine2 ? `<p>${addressLine2}</p>` : ''}
                    <p>${[city, stateVal, postalCode].filter(Boolean).join(', ')}</p>
                    ${country ? `<p>${country}</p>` : ''}
                    ${phoneDisplay ? `<p class="mt-2 font-semibold">üìû ${phoneDisplay}</p>` : ''}
                    ${addr.email ? `<p class="text-gray-400">‚úâÔ∏è ${addr.email}</p>` : ''}
                    ${specialInstructions ? `<p class="mt-3 text-sm text-gray-500 italic">Note: ${specialInstructions}</p>` : ''}
                </div>
            `;
        }
    }
    
    detailContainer.innerHTML = `
        <div class="mb-8">
            <button class="btn-secondary text-sm px-4 py-2 mb-6" onclick="backToCustomerList()">
                ‚Üê BACK TO LIST
            </button>
            
            <div class="flex flex-col gap-1 mb-6">
                <h3 class="text-2xl font-bold tracking-brutal">${customer.name || 'Unknown'}</h3>
                <p class="text-gray-400 font-mono">${customer.email || 'No email'}</p>
                <p class="text-gray-400">${customer.phone || 'No phone number'}</p>
            </div>
            
            <div class="bg-[#111] p-5 border border-gray-800 rounded-lg">
                <p class="text-xs text-muted mb-4 tracking-widest uppercase">Shipping Address</p>
                ${addressHtml}
            </div>
        </div>
        
        <div class="space-y-3">
            <h4 class="font-bold mb-4 text-lg">Bid History (${customer.bids.length})</h4>
            ${customer.bids.length ? customer.bids.map(bid => {
                const product = state.products.find(p => p.id === bid.productId);
                return `
                    <div class="bg-gray-900/50 p-4 border-l-2 rounded-lg ${bid.status === 'WINNER' ? 'border-green-500' : 'border-gray-700'}">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-bold text-lg">${product?.name || 'Product'}</p>
                                <p class="text-xs text-gray-500 font-mono">Code: ${bid.code}</p>
                            </div>
                            <span class="text-xs px-2 py-1 rounded font-bold tracking-wider ${bid.status === 'ACTIVE' ? 'bg-green-500/20 text-green-500' : 
                                bid.status === 'WINNER' ? 'bg-blue-500/20 text-blue-500' : 'bg-gray-500/20 text-gray-500'}">
                                ${bid.status}
                            </span>
                        </div>
                        <div class="flex justify-between items-center text-sm mt-3">
                            <span class="font-bold text-gray-300">‚Çπ${bid.bidAmount?.toLocaleString() || '0'}</span>
                            <span class="text-gray-500 text-xs">${new Date(bid.createdAt).toLocaleDateString()}</span>
                        </div>
                        ${bid.size ? `<p class="text-xs text-gray-500 mt-2">Size: ${bid.size}</p>` : ''}
                    </div>
                `;
            }).join('') : '<p class="text-gray-500">No bids found</p>'}
        </div>
    `;
}

function backToCustomerList() {
    document.getElementById('adminCustomerDetail').classList.add('hidden');
    document.getElementById('adminCustomerList').classList.remove('hidden');
}

function renderAdminBids() {
    const container = document.getElementById('adminBidsList');
    
    // Sort bids by amount (highest first)
    const sortedBids = [...state.bids].sort((a, b) => (b.bidAmount || 0) - (a.bidAmount || 0));
    
    if (!sortedBids.length) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">No bids placed yet</p>';
        return;
    }
    
    container.innerHTML = sortedBids.map(bid => {
        const product = state.products.find(p => p.id === bid.productId);
        return `
            <div class="bg-gray-900/50 p-4 flex items-center justify-between">
                <div>
                    <div class="flex items-center gap-2 mb-1">
                        <p class="font-mono font-bold">${bid.code}</p>
                        <span class="text-xs px-2 py-1 rounded ${bid.status === 'ACTIVE' ? 'bg-green-500/20 text-green-500' : 
                            bid.status === 'WINNER' ? 'bg-blue-500/20 text-blue-500' : 'bg-gray-500/20 text-gray-500'}">
                            ${bid.status}
                        </span>
                    </div>
                    <p class="text-sm text-gray-400">${product?.name || 'Product'}</p>
                </div>
                <div class="text-right">
                    <p class="text-xl font-bold">‚Çπ${(bid.bidAmount || 0).toLocaleString()}</p>
                    <p class="text-xs text-gray-500">${new Date(bid.createdAt).toLocaleDateString()}</p>
                </div>
            </div>
        `;
    }).join('');
}

function updateBidRegistrationFee(value) {
    const fee = parseInt(value, 10);
    if (isNaN(fee) || fee < 0) {
        alert('Please enter a valid amount');
        document.getElementById('settingsBidFee').value = state.settings.bidRegistrationFee;
        return;
    }
    
    state.settings.bidRegistrationFee = fee;
    saveState();
    alert(`Bid registration fee updated to ‚Çπ${fee.toLocaleString()}`);
}

// Winner Payment Functions
function openWinnerPayment(bidId, productId, amount) {
    const bid = state.bids.find(b => b.id === bidId);
    const product = state.products.find(p => p.id === productId);
    
    if (!bid || !product) {
        alert('Error: Bid or product not found');
        return;
    }
    
    // Create payment modal
    const modalHTML = `
        <div class="fixed inset-0 bg-black/95 z-100 flex items-center justify-center p-6">
            <div class="bg-gray-900 w-full max-w-md rounded-lg overflow-hidden border border-gray-800">
                <div class="p-6 border-b border-gray-800">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold">Complete Payment</h2>
                        <button onclick="closePaymentModal()" class="w-8 h-8 flex items-center justify-center text-xl opacity-60 hover:opacity-100">√ó</button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="flex gap-4 mb-6">
                        <img src="${product.images?.[0] || ''}" class="w-20 h-24 object-cover rounded" alt="${product.name}">
                        <div>
                            <p class="font-bold text-lg">${product.name}</p>
                            <p class="text-sm text-gray-400">You won this auction!</p>
                            <p class="text-xs text-gray-500 mt-1">Code: ${bid.code}</p>
                        </div>
                    </div>
                    
                    <div class="bg-black/50 p-4 rounded-lg mb-6 space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">Your Bid Amount</span>
                            <span class="text-white">‚Çπ${bid.bidAmount.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">Registration Fee Paid</span>
                            <span class="text-green-400">- ‚Çπ${(state.settings?.bidRegistrationFee || 100).toLocaleString()}</span>
                        </div>
                        <div class="border-t border-gray-700 pt-2 mt-2">
                            <div class="flex justify-between font-bold">
                                <span>Amount Due</span>
                                <span class="text-xl text-green-400">‚Çπ${amount.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${bid.isSecondChance ? `
                        <div class="bg-blue-900/30 border border-blue-800 p-3 rounded-lg mb-4 text-sm">
                            <p class="text-blue-400">üéâ This is a second-chance offer.</p>
                            <p class="text-blue-300 text-xs mt-1">No obligation or penalty if you choose not to pay.</p>
                        </div>
                    ` : `
                        <div class="bg-yellow-900/20 border border-yellow-800 p-3 rounded-lg mb-4 text-sm">
                            <p class="text-yellow-400">‚ö†Ô∏è Payment must be completed within 24 hours.</p>
                            <p class="text-yellow-300 text-xs mt-1">Failure to pay will result in 3√ó penalty.</p>
                        </div>
                    `}
                    
                    <button class="btn-primary w-full" onclick="processWinnerPayment(${bidId}, ${productId}, ${amount})">
                        PAY ‚Çπ${amount.toLocaleString()} NOW
                    </button>
                    
                    <p class="text-xs text-gray-500 text-center mt-4">Secure payment via Razorpay/UPI</p>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    closePaymentModal();
    
    const modal = document.createElement('div');
    modal.id = 'winnerPaymentModal';
    modal.innerHTML = modalHTML;
    document.body.appendChild(modal);
}

function closePaymentModal() {
    const modal = document.getElementById('winnerPaymentModal');
    if (modal) modal.remove();
}

function processWinnerPayment(bidId, productId, amount) {
    // Simulate payment processing (demo)
    const confirmed = confirm(`Proceed with payment of ‚Çπ${amount.toLocaleString()}?\n\n(This is a demo - no real payment will be processed)`);
    
    if (confirmed) {
        const bid = state.bids.find(b => b.id === bidId);
        if (bid) {
            bid.paymentCompleted = true;
            bid.paymentCompletedAt = new Date().toISOString();
            bid.amountPaid = amount;
            saveState();
            
            closePaymentModal();
            alert('üéâ Payment successful! Your order will be shipped soon.');
            renderMyAccount();
        }
    }
}

// Admin function to assign to second highest bidder
function assignToSecondHighest(productId) {
    const productBids = state.bids
        .filter(b => b.productId === productId && b.bidAmount > 0)
        .sort((a, b) => b.bidAmount - a.bidAmount);
    
    if (productBids.length < 2) {
        alert('No second highest bidder available');
        return;
    }
    
    // Mark current winner as defaulted
    const currentWinner = productBids.find(b => b.status === 'WINNER');
    if (currentWinner) {
        currentWinner.status = 'DEFAULTED';
        currentWinner.defaultedAt = new Date().toISOString();
        
        // Calculate penalty
        const product = state.products.find(p => p.id === productId);
        if (product) {
            currentWinner.penaltyAmount = product.price * 3;
        }
    }
    
    // Find next eligible bidder (not the defaulted one)
    const secondHighest = productBids.find(b => b.status !== 'WINNER' && b.status !== 'DEFAULTED');
    
    if (secondHighest) {
        secondHighest.status = 'WINNER';
        secondHighest.isSecondChance = true;
        secondHighest.wonAt = new Date().toISOString();
        
        // Create order for second-chance winner
        const product = state.products.find(p => p.id === productId);
        const order = {
            id: Date.now(),
            productId,
            bidId: secondHighest.id,
            code: secondHighest.code,
            name: secondHighest.name,
            email: secondHighest.email,
            phone: secondHighest.phone,
            address: secondHighest.address,
            size: secondHighest.size,
            bidAmount: secondHighest.bidAmount,
            isSecondChance: true,
            status: 'AWAITING_PAYMENT',
            createdAt: new Date().toISOString()
        };
        
        state.orders.push(order);
        saveState();
        
        alert(`Second chance offered to bidder ${secondHighest.code} (‚Çπ${secondHighest.bidAmount.toLocaleString()})\n\nNote: This bidder has no obligation to pay.`);
        renderAdminOrders();
    } else {
        alert('No eligible second highest bidder found');
    }
}

// Function to check and handle payment deadlines
function checkPaymentDeadlines() {
    const now = new Date();
    
    state.bids.forEach(bid => {
        if (bid.status === 'WINNER' && !bid.paymentCompleted && !bid.isSecondChance && bid.wonAt) {
            const wonAt = new Date(bid.wonAt);
            const deadline = new Date(wonAt.getTime() + (24 * 60 * 60 * 1000));
            
            if (now > deadline && !bid.deadlineNotified) {
                bid.deadlineNotified = true;
                saveState();
            }
        }
    });
}

function renderAdminApplied() {
    const container = document.getElementById('adminAppliedList');
    const searchTerm = document.getElementById('appliedSearch')?.value?.toLowerCase() || '';
    
    // Group applied users by product
    const productMap = {};
    
    state.bids.forEach(bid => {
        if (!productMap[bid.productId]) {
            productMap[bid.productId] = {
                product: state.products.find(p => p.id === bid.productId),
                bids: []
            };
        }
        productMap[bid.productId].bids.push(bid);
    });
    
    // Filter by search term
    const filteredProducts = Object.values(productMap).filter(item => {
        if (!searchTerm) return true;
        
        // Search in product name
        if (item.product?.name?.toLowerCase().includes(searchTerm)) return true;
        
        // Search in bid codes
        return item.bids.some(bid => bid.code.includes(searchTerm));
    });
    
    if (!filteredProducts.length) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">No applications found</p>';
        return;
    }
    
    container.innerHTML = filteredProducts.map(item => {
        const activeCount = item.bids.filter(b => b.status === 'ACTIVE').length;
        const winner = item.bids.find(b => b.status === 'WINNER');
        
        return `
            <div class="bg-gray-900/50 p-4">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <img src="${item.product?.images?.[0] || ''}" class="w-12 h-16 object-cover" alt="${item.product?.name}">
                        <div>
                            <p class="font-bold">${item.product?.name || 'Product'}</p>
                            <p class="text-sm text-gray-400">${item.bids.length} application${item.bids.length !== 1 ? 's' : ''}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm ${activeCount > 0 ? 'text-green-500' : 'text-gray-500'}">
                            ${activeCount} active
                        </p>
                        ${winner ? 
                            `<p class="text-xs text-blue-500">Winner: ${winner.code}</p>` : 
                            `<button class="bg-transparent border border-gray-600 text-white text-[11px] font-semibold tracking-wide py-2 px-3 rounded-lg hover:border-white hover:bg-white/5 transition-all whitespace-nowrap mt-1" onclick="selectWinner(${item.product?.id})">
                                SELECT WINNER
                            </button>`
                        }
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    ${item.bids.map(bid => `
                        <div class="bg-black/30 p-2 text-xs">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-mono">${bid.code}</span>
                                <span class="px-1 rounded ${bid.status === 'ACTIVE' ? 'bg-green-500/20 text-green-500' : 
                                    bid.status === 'WINNER' ? 'bg-blue-500/20 text-blue-500' : 'bg-gray-500/20 text-gray-500'}">
                                    ${bid.status}
                                </span>
                            </div>
                            <p class="truncate">‚Çπ${(bid.bidAmount || 0).toLocaleString()}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }).join('');
}

/**
 * ========================================
 * UTILITY FUNCTIONS
 * ========================================
 */
// Initialize the application
window.addEventListener('DOMContentLoaded', init);

// Restore session on full load
window.addEventListener('load', async () => {
    try {
        const res = await fetch(`${API_BASE}/me`, { credentials: 'include' });
        if (res.ok) {
            const user = await res.json();
            state.user = user;
        }
    } catch (e) {}
    renderDynamicMenu();
    navigateTo('home');
});

// Prevent form submission on enter
window.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
    }
});

// Handle image slider for product page
document.addEventListener('DOMContentLoaded', function() {
    // Initialize any sliders
    const sliders = document.querySelectorAll('.image-slider');
    sliders.forEach(slider => {
        let isDown = false;
        let startX;
        let scrollLeft;
        
        slider.addEventListener('mousedown', (e) => {
            isDown = true;
            startX = e.pageX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
        });
        
        slider.addEventListener('mouseleave', () => {
            isDown = false;
        });
        
        slider.addEventListener('mouseup', () => {
            isDown = false;
        });
        
        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - slider.offsetLeft;
            const walk = (x - startX) * 2;
            slider.scrollLeft = scrollLeft - walk;
        });
    });

    // Add tab switching logic for admin panel
    const adminTabs = document.querySelectorAll('.admin-tab');
    adminTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            // Update active tab style
            adminTabs.forEach(t => {
                t.classList.remove('border-white', 'text-white');
                t.classList.add('border-transparent', 'text-gray-500');
            });
            tab.classList.remove('border-transparent', 'text-gray-500');
            tab.classList.add('border-white', 'text-white');
            
            // Show content
            const tabName = tab.dataset.tab;
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.remove('hidden');
            
            // Refresh data based on tab
            if (tabName === 'dashboard') renderAdminDashboard();
            if (tabName === 'products') renderAdminProducts();
            if (tabName === 'orders') renderAdminOrders();
            if (tabName === 'customers') renderAdminCustomers();
            if (tabName === 'bids') renderAdminBids();
            if (tabName === 'applied') renderAdminApplied();
        });
    });
});

function setupAdminTabs() {
    // Logic moved to DOMContentLoaded
}

// Make functions available globally
window.navigateTo = navigateTo;
window.toggleMenu = toggleMenu;
window.handleSecretTap = handleSecretTap;
window.goToAdmin = goToAdmin;
window.logoutAdmin = logoutAdmin;
window.selectSize = selectSize;
window.startApplication = startApplication;
window.openGallery = openGallery;
window.closeGallery = closeGallery;
window.continueApplication = continueApplication;
window.confirmDeposit = confirmDeposit;
window.processPayment = processPayment;
window.handleSignup = handleSignup;
window.handleOTP = handleOTP;
window.handleUserLogin = handleUserLogin;
window.handleLogout = handleLogout;
window.saveAccountDetails = saveAccountDetails;
window.goToPlaceBid = goToPlaceBid;
window.submitBid = submitBid;
window.editBid = editBid;
window.editBidFromList = editBidFromList;
window.adminLogin = adminLogin;
window.showAddProduct = showAddProduct;
window.closeProductModal = closeProductModal;
window.previewImages = previewImages;
window.addImagesFromUrls = addImagesFromUrls;
window.removeImage = removeImage;
window.saveProduct = saveProduct;
window.toggleProductStatus = toggleProductStatus;
window.selectAllOrders = selectAllOrders;
window.deselectAllOrders = deselectAllOrders;
window.printSelectedLabels = printSelectedLabels;
window.selectWinner = selectWinner;
window.closeWinnerModal = closeWinnerModal;
window.confirmWinner = confirmWinner;
window.updatePrintSelection = updatePrintSelection;
window.showCustomerDetail = showCustomerDetail;
window.backToCustomerList = backToCustomerList;
window.validateCountryCode = validateCountryCode;
window.validatePhoneNumber = validatePhoneNumber;
window.validatePostalCode = validatePostalCode;
window.renderAdminApplied = renderAdminApplied;
window.updateBidRegistrationFee = updateBidRegistrationFee;
window.openWinnerPayment = openWinnerPayment;
window.processWinnerPayment = processWinnerPayment;
window.assignToSecondHighest = assignToSecondHighest;
window.closePaymentModal = closePaymentModal;
window.handleLogout = handleLogout;
window.handleSignup = handleSignup;
window.handleOTP = handleOTP;
window.handleUserLogin = handleUserLogin;
window.saveAccountDetails = saveAccountDetails;
window.processPayment = processPayment;

// Add initial history state
window.addEventListener('load', function() {
    try {
        history.replaceState({ page: 'home', data: null }, '', '#home');
    } catch (e) {}
});
</script>
</body>
</html>